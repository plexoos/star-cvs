<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>StDetectorDbRichVoltages.cxx Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.8.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>StDetectorDbRichVoltages.cxx</h1><a href="StDetectorDbRichVoltages_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="preprocessor">#include "<a class="code" href="StDetectorDbRichVoltages_8h.html">StDetectorDbRichVoltages.h</a>"</font>
00002 <font class="preprocessor">#include "<a class="code" href="StDetectorDbInterpolator_8h.html">StDetectorDbInterpolator.h</a>"</font>
00003 <font class="preprocessor">#include "TDataSet.h"</font>
00004 <font class="preprocessor">#include "TTable.h"</font>
00005 <font class="preprocessor">#include "StMaker.h"</font>
00006 <font class="comment"></font>
00007 <font class="comment">/// Needs a StMaker* passed in. This is because GetDatabase only works in a maker class. So this must be declared inside a maker.</font>
<a name="l00008"></a><a class="code" href="classStDetectorDbRichVoltages.html#a0">00008</a> <font class="comment"></font><a class="code" href="classStDetectorDbRichVoltages.html#a0">StDetectorDbRichVoltages::StDetectorDbRichVoltages</a>(StMaker* maker)<font class="keyword"></font>{
00009     cout &lt;&lt; <font class="stringliteral">"StDetectorDbRichVoltages::StDetectorDbRichVoltages"</font> &lt;&lt; endl;
00010 
00011     mNumEntries = 0;
00012     mRunNumber = 0;
00013     mStatusTimes = 0;
00014     mStatus = 0;
00015     mEventTime = 0;
00016 
00017     <font class="keywordflow">if</font>(maker){
00018         <font class="comment">// For some reason, the maker GetDateTime is not in GMT!!!!</font>
00019         mEventTime = maker-&gt;GetDateTime().Convert() - 14400;
00020                 
00021         TDataSet* dataSet = maker-&gt;GetDataBase(<font class="stringliteral">"RunLog/rhic"</font>);
00022         
00023         <font class="keywordflow">if</font>(dataSet){
00024             TTable* table = dynamic_cast&lt;TTable*&gt;(dataSet-&gt;Find(<font class="stringliteral">"richvoltages"</font>));
00025             <font class="keywordflow">if</font>(table){
00026                 mNumEntries = table-&gt;GetNRows() ;
00027                 <font class="keywordflow">if</font>(mNumEntries){
00028                     <a class="code" href="structrichvoltages__st.html">richvoltages_st</a>* value = (<a class="code" href="structrichvoltages__st.html">richvoltages_st</a>*)(table-&gt;GetArray());
00029                     
00030                     mRunNumber = value[0].runNumber;
00031                     mStatusTimes = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>[mNumEntries+1];
00032                     mStatus = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>[mNumEntries];
00033                     
00034                     <font class="keywordflow">for</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i = 0;i &lt; mNumEntries;i++){
00035                         mStatusTimes[i] = value[i].startStatusTime;
00036                         mStatusTimes[i+1] = value[i].endStatusTime;
00037                         mStatus[i] = value[i].status;
00038                     }
00039                 }
00040             }
00041         }
00042     }
00043 };
00044     <font class="comment"></font>
00045 <font class="comment">    /// Delete all the arrays</font>
<a name="l00046"></a><a class="code" href="classStDetectorDbRichVoltages.html#a1">00046</a> <font class="comment"></font><a class="code" href="classStDetectorDbRichVoltages.html#a1">StDetectorDbRichVoltages::~StDetectorDbRichVoltages</a>()<font class="keyword"></font>{
00047     
00048     <font class="keyword">delete</font> mStatusTimes;
00049     <font class="keyword">delete</font> mStatus;
00050 };
00051 <font class="comment"></font>
00052 <font class="comment">/// sets the Event time</font>
<a name="l00053"></a><a class="code" href="classStDetectorDbRichVoltages.html#a2">00053</a> <font class="comment"></font><font class="keywordtype">void</font> <a class="code" href="classStDetectorDbRichVoltages.html#a2">StDetectorDbRichVoltages::setEventTime</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> value)<font class="keyword"></font>{ mEventTime = value;};
00054 <font class="comment"></font>
00055 <font class="comment">/// sets the run number</font>
<a name="l00056"></a><a class="code" href="classStDetectorDbRichVoltages.html#a3">00056</a> <font class="comment"></font><font class="keywordtype">void</font> <a class="code" href="classStDetectorDbRichVoltages.html#a3">StDetectorDbRichVoltages::setRunNumber</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> value)<font class="keyword"></font>{ mRunNumber = value;};
00057 <font class="comment"></font>
00058 <font class="comment">/// sets the number of entries in the class (must be done because using static arrays</font>
<a name="l00059"></a><a class="code" href="classStDetectorDbRichVoltages.html#a4">00059</a> <font class="comment"></font><font class="keywordtype">void</font> <a class="code" href="classStDetectorDbRichVoltages.html#a4">StDetectorDbRichVoltages::setNumEntries</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> value)<font class="keyword"></font>{ mNumEntries = value;};
00060 <font class="comment"></font>
00061 <font class="comment">/// sets the status time. This is a list of values when the status of the detector changes.</font>
<a name="l00062"></a><a class="code" href="classStDetectorDbRichVoltages.html#a5">00062</a> <font class="comment"></font><font class="keywordtype">void</font> <a class="code" href="classStDetectorDbRichVoltages.html#a5">StDetectorDbRichVoltages::setStatusTimes</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>* value)<font class="keyword"></font>{ mStatusTimes = value;};
00063 <font class="comment"></font>
00064 <font class="comment">/// sets the status that corresponds to the statusTimes. each value is valid from the</font>
00065 <font class="comment">/// corresponding element in statusTimes untill the next element in statusTime where</font>
<a name="l00066"></a><a class="code" href="classStDetectorDbRichVoltages.html#a6">00066</a> <font class="comment"></font><font class="keywordtype">void</font> <a class="code" href="classStDetectorDbRichVoltages.html#a6">StDetectorDbRichVoltages::setStatus</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>* value)<font class="keyword"></font>{ mStatus = value;};
00067 <font class="comment"></font>
00068 <font class="comment">/// gets the Eventtime</font>
<a name="l00069"></a><a class="code" href="classStDetectorDbRichVoltages.html#a7">00069</a> <font class="comment"></font><font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> <a class="code" href="classStDetectorDbRichVoltages.html#a7">StDetectorDbRichVoltages::getEventTime</a>()<font class="keyword"></font>{ <font class="keywordflow">return</font> mEventTime;};
00070 <font class="comment"></font>
00071 <font class="comment">/// gets the runnumber of the data</font>
<a name="l00072"></a><a class="code" href="classStDetectorDbRichVoltages.html#a8">00072</a> <font class="comment"></font><font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> <a class="code" href="classStDetectorDbRichVoltages.html#a8">StDetectorDbRichVoltages::getRunNumber</a>()<font class="keyword"></font>{ <font class="keywordflow">return</font> mRunNumber;};
00073 <font class="comment"></font>
00074 <font class="comment">/// gets the number of different status corresponding to an event</font>
<a name="l00075"></a><a class="code" href="classStDetectorDbRichVoltages.html#a9">00075</a> <font class="comment"></font><font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> <a class="code" href="classStDetectorDbRichVoltages.html#a9">StDetectorDbRichVoltages::getNumEntries</a>()<font class="keyword"></font>{ <font class="keywordflow">return</font> mNumEntries;};
00076 <font class="comment"></font>
00077 <font class="comment">/// gets the status of the event from the passed in timestamp</font>
00078 <font class="comment">/// one can get the event timestamp from StEvent::time() along with other methods</font>
<a name="l00079"></a><a class="code" href="classStDetectorDbRichVoltages.html#a10">00079</a> <font class="comment"></font><font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> <a class="code" href="classStDetectorDbRichVoltages.html#a10">StDetectorDbRichVoltages::getStatus</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> time)<font class="keyword"></font>{
00080 
00081     <font class="keywordflow">if</font>(time==0)
00082         time = this-&gt;<a class="code" href="classStDetectorDbRichVoltages.html#a7">getEventTime</a>();
00083     
00084     <a class="code" href="classStDetectorDbInterpolator.html">StDetectorDbInterpolator&lt;unsigned int&gt;</a> inter(this-&gt;getNumEntries(),mStatusTimes,mStatus);
00085     <font class="keywordflow">return</font> inter.<a class="code" href="classStDetectorDbInterpolator.html#a2">getLowerValue</a>(time);
00086 };
00087 <font class="comment"></font>
00088 <font class="comment">/// prints all the datamembers to standard out</font>
<a name="l00089"></a><a class="code" href="StDetectorDbRichVoltages_8cxx.html#a0">00089</a> <font class="comment"></font>ostream&amp; <a class="code" href="StDetectorDbRichVoltages_8cxx.html#a0">operator&lt;&lt;</a>(ostream&amp; os, <a class="code" href="classStDetectorDbRichVoltages.html">StDetectorDbRichVoltages</a>&amp; v)<font class="keyword"></font>{
00090     
00091     os &lt;&lt; <font class="stringliteral">"Run "</font> &lt;&lt; v.mRunNumber &lt;&lt; <font class="stringliteral">"\t Number of Rows "</font> &lt;&lt; v.mNumEntries &lt;&lt; endl;
00092 
00093     os &lt;&lt; <font class="stringliteral">"Status"</font> &lt;&lt; <font class="stringliteral">"\t"</font> &lt;&lt; <font class="stringliteral">"BeginTime"</font> &lt;&lt; <font class="stringliteral">"\t"</font> &lt;&lt; <font class="stringliteral">"EndTime"</font> &lt;&lt; endl;
00094     
00095     <font class="keywordflow">for</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i=0; i &lt; v.<a class="code" href="classStDetectorDbRichVoltages.html#a9">getNumEntries</a>() ; i++){
00096         os &lt;&lt; v.mStatus[i] &lt;&lt; <font class="stringliteral">"\t"</font> &lt;&lt; v.mStatusTimes[i] &lt;&lt; <font class="stringliteral">"\t"</font> &lt;&lt; v.mStatusTimes[i+1] &lt;&lt; endl;
00097     }
00098 
00099     <font class="keywordflow">return</font> os;
00100     
00101 };
00102 
00103 
</pre></div><hr><address><small>Generated at Sat Dec 1 18:45:57 2001 for StDetectorDbMaker by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.8.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
