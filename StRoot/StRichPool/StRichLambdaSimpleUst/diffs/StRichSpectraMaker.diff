Only in StRoot/StRichSpectraMaker: .consign
diff -urb StRoot_old/StRichSpectraMaker/StRichSpectraMaker.cxx StRoot/StRichSpectraMaker/StRichSpectraMaker.cxx
--- StRoot_old/StRichSpectraMaker/StRichSpectraMaker.cxx	Wed May 22 22:00:52 2002
+++ StRoot/StRichSpectraMaker/StRichSpectraMaker.cxx	Tue Nov 19 13:35:45 2002
@@ -347,7 +347,8 @@
     mPtCut = 0.*GeV; // GeV/c
     mEtaCut = 0.5; 
     mLastHitCut = 100.0*centimeter;
-    mDcaCut = 3.0*centimeter;
+// Remove this from 3 to 10000
+    mDcaCut = 10000.0*centimeter;
     mFitPointsCut = 20;
     mPathCut = 500*centimeter;
     mPadPlaneCut = 1.0*centimeter;
@@ -564,10 +565,14 @@
     trackTuple[0] = mVertexPos.z();
 
 //     cout << "Looping over " << mNumberOfPrimaries << " primary Tracks" << endl;
-    for(size_t ii=0; ii<mNumberOfPrimaries; ii++) { // primaries
+//    for(size_t ii=0; ii<mNumberOfPrimaries; ii++) { // primaries
+    for (StSPtrVecTrackNodeIterator titer = mEvent->trackNodes().begin();
+	 titer != mEvent->trackNodes().end(); ++titer) {
+	for (size_t ientry =0; ientry < (*titer)->entries(); ++ientry) {
+	    StTrack *track = (*titer)->track(ientry);
 
 //  	cout << "==> Track " << ii << "/" << (mNumberOfPrimaries-1);
-	StTrack* track = mEvent->primaryVertex()->daughter(ii);
+//	StTrack* track = mEvent->primaryVertex()->daughter(ii);
   	//cout << "*****Track " << ii << "\tp= " << track->geometry()->momentum().mag() << endl;
 
 	//if( !this->checkMomentumWindow(track) ) continue;
@@ -588,10 +593,16 @@
 	//
 	// Get the PID traits, if there is an StrichPIDTrait:
 	//
-	const StPtrVecTrackPidTraits&
-	    theRichPidTraits = track->pidTraits(kRichId);
+        StSPtrVecTrackPidTraits&
+	    theRichPidTraits = track->pidTraits();
+	StTrackPidTraits* theSelectedTrait = 0;
+	for (StSPtrVecTrackPidTraitsIterator piter = theRichPidTraits.begin();
+	     piter != theRichPidTraits.end(); ++piter) {
+	    if (dynamic_cast<StRichPidTraits*>(*piter)) theSelectedTrait = *piter;
+	}
+	
+	if (!theSelectedTrait) continue;
 
-	if(!theRichPidTraits.size()) continue;
 //   	cout << " (" << theRichPidTraits.size() << ") Pid Traits.   p= ";
 
 	//
@@ -611,8 +622,6 @@
 	// info from the traits
 	//
 	
-	StTrackPidTraits* theSelectedTrait =
-	    theRichPidTraits[theRichPidTraits.size()-1];
 
 	if(!theSelectedTrait) {
 	    cout << "Error in the Selected Trait\nContinuing..." << endl;
@@ -621,6 +630,7 @@
 	
 	StRichPidTraits *richPidTrait =
 	    dynamic_cast<StRichPidTraits*>(theSelectedTrait);
+	if (!richPidTrait) continue;
 
 	//
 	// this should not be necessary for the
@@ -757,11 +767,13 @@
 	//
 	// default Production
 	//
-	spectraInfo->setVersion(20011);  
+	spectraInfo->setVersion(20013);  
 	dynamic_cast<StRichPidTraits*>(theSelectedTrait)->setRichSpectra(spectraInfo);
 	//
 	//////////////////////////////////////////////////
 #endif	
+	} //loop over tracks
+	
     } // loop over the tracks
 
       cout << "try clear data from histogram" << endl;
