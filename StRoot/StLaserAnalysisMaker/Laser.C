#if !defined(__CINT__) || defined(__MAKECINT__)
//#include <ostream>
#include "Riostream.h"
#include <stdio.h>
#include "TROOT.h"
#include "TSystem.h"
#include "TMath.h"
#include "TH1.h"
#include "TH2.h"
#include "TH3.h"
#include "TStyle.h"
#include "TF1.h"
#include "TProfile.h"
#include "TTree.h"
#include "TChain.h"
#include "TFile.h"
#include "TNtuple.h"
#include "TCanvas.h"
#include "TString.h"
#include "TList.h"
#include "TLegend.h"
#endif
static Int_t run = 0;
static Int_t date = 0;
static Int_t Time = 0;
//             Delta/dv  All,West,East
static Double_t  DVAll[2][3];
static Double_t dDVAll[2][3];
struct RunTime_t {
  Int_t runNumber;
  Int_t beginDate;
  Int_t beginTime;
};
static const RunTime_t RuntTime[] = {
  {6005094,	20050105, 191108}, {6005095,	20050105, 191120}, {6012001,	20050112,  50534},
  {6012002,	20050112,  50758}, {6012004,	20050112,  52821}, {6012016,	20050112,  95303},
  {6012030,	20050112, 132842}, {6012031,	20050112, 133303}, {6012032,	20050112, 133537},
  {6012033,	20050112, 133813}, {6012034,	20050112, 135142}, {6012035,	20050112, 135406},
  {6012036,	20050112, 135632}, {6012037,	20050112, 135853}, {6013045,	20050113, 101622},
  {6013065,	20050113, 141843}, {6014101,	20050115,  41638}, {6015022,	20050115, 114230},
  {6015033,	20050115, 141755}, {6015048,	20050116,   1145}, {6015060,	20050116,  25914},
  {6016016,	20050116, 152429}, {6016052,	20050116, 214621}, {6016053,	20050116, 215223},
  {6017010,	20050117,  65455}, {6017011,	20050117,  65925}, {6017059,	20050117, 175657},
  {6017066,	20050117, 191037}, {6018008,	20050118, 100541}, {6018013,	20050118, 124710},
  {6018043,	20050119,   2831}, {6020022,	20050120, 202527}, {6020023,	20050120, 202619},
  {6020024,	20050120, 202755}, {6020025,	20050120, 202922}, {6020026,	20050120, 203341},
  {6020027,	20050120, 203946}, {6020063,	20050121,  34208}, {6021008,	20050121,  95757},
  {6021046,	20050122,  12419}, {6022008,	20050122,  91552}, {6022047,	20050122, 181854},
  {6022091,	20050123,  12353}, {6023010,	20050123,  75912}, {6025039,	20050125,  90829},
  {6025051,	20050125, 123652}, {6025113,	20050126,   3421}, {6025114,	20050126,   4111},
  {6025122,	20050126,  20119}, {6026019,	20050126,  64957}, {6026047,	20050126, 132839},
  {6026062,	20050126, 160050}, {6026063,	20050126, 160545}, {6026064,	20050126, 161052},
  {6026065,	20050126, 161611}, {6026079,	20050126, 211641}, {6026080,	20050126, 211937},
  {6026099,	20050127,  25328}, {6027019,	20050127, 105558}, {6027068,	20050128,  11529},
  {6028005,	20050128, 103114}, {6028012,	20050128, 134933}, {6028079,	20050129,  12044},
  {6029006,	20050129,  65330}, {6029020,	20050129, 123942}, {6029065,	20050130,  40833},
  {6030014,	20050130,  81847}, {6030063,	20050130, 191841}, {6030064,	20050130, 192436},
  {6030095,	20050131,  11315}, {6031007,	20050131,  81832}, {6031035,	20050131, 142745},
  {6031036,	20050131, 143601}, {6031112,	20050201,  40502}, {6032012,	20050201,  91018},
  {6032033,	20050201, 194502}, {6034011,	20050203, 113858}, {6034018,	20050203, 141730},
  {6034019,	20050203, 142434}, {6034110,	20050204,   5142}, {6034111,	20050204,   5753},
  {6035008,	20050204,  61742}, {6035029,	20050204, 123111}, {6035110,	20050204, 234609},
  {6036015,	20050205,  65947}, {6036041,	20050205, 140613}, {6036070,	20050205, 190521},
  {6036071,	20050205, 190641}, {6036099,	20050206,  14944}, {6036101,	20050206,  15755},
  {6037012,	20050206,  80215}, {6037032,	20050206, 141515}, {6037051,	20050206, 202739},
  {6037072,	20050207,  33312}, {6038010,	20050207,  82020}, {6038038,	20050207, 203602},
  {6038039,	20050207, 204131}, {6038040,	20050207, 204706}, {6038041,	20050207, 205904},
  {6038042,	20050207, 210202}, {6038086,	20050208,  41502}, {6039030,	20050208, 105610},
  {6039047,	20050208, 135930}, {6039048,	20050208, 140621}, {6039049,	20050208, 141127},
  {6039050,	20050208, 141640}, {6039051,	20050208, 142948}, {6039137,	20050208, 231639},
  {6040002,	20050209,  62924}, {6040046,	20050210,   3726}, {6040047,	20050210,   5835},
  {6040059,	20050210,  41100}, {6040060,	20050210,  41550}, {6041019,	20050210,  73740},
  {6041052,	20050210, 135549}, {6041056,	20050210, 143249}, {6041057,	20050210, 143556},
  {6041094,	20050210, 235401}, {6042002,	20050211,  51902}, {6042056,	20050211, 123421},
  {6042068,	20050211, 140830}, {6042106,	20050212,  11513}, {6043013,	20050212,  70259},
  {6043053,	20050212, 141340}, {6043088,	20050212, 212458}, {6043116,	20050213,  24905},
  {6044023,	20050213,  94115}, {6044052,	20050213, 185950}, {6044082,	20050214,  10251},
  {6045032,	20050214,  80622}, {6045074,	20050215,  24515}, {6046021,	20050215,  81343},
  {6046036,	20050215, 121651}, {6046080,	20050215, 191339}, {6046081,	20050215, 191921},
  {6046083,	20050215, 192503}, {6046086,	20050215, 193115}, {6046089,	20050215, 193441},
  {6046090,	20050215, 193536}, {6046091,	20050215, 194017}, {6046092,	20050215, 194614},
  {6046093,	20050215, 194922}, {6046094,	20050215, 195329}, {6047024,	20050216,  85004},
  {6047041,	20050216, 120550}, {6048015,	20050217, 105839}, {6048026,	20050217, 140541},
  {6048078,	20050218,  32216}, {6049035,	20050218, 100313}, {6049093,	20050218, 192936},
  {6049120,	20050219,  25551}, {6049121,	20050219,  30018}, {6049122,	20050219,  30429},
  {6049125,	20050219,  31445}, {6050014,	20050219,  74124}, {6050038,	20050219, 140650},
  {6050118,	20050220,   1609}, {6050133,	20050220,  44905}, {6051019,	20050220, 102253},
  {6051039,	20050220, 144158}, {6051051,	20050220, 190400}, {6051106,	20050221,  44602},
  {6051107,	20050221,  44814}, {6051109,	20050221,  45206}, {6052002,	20050221,  53352},
  {6052029,	20050221, 102253}, {6052060,	20050221, 162646}, {6052097,	20050221, 225714},
  {6053023,	20050222, 114907}, {6053086,	20050222, 234210}, {6054012,	20050223,  61531},
  {6054033,	20050223, 110532}, {6054065,	20050224,  21836}, {6054066,	20050224,  22439},
  {6055010,	20050224,  84010}, {6055029,	20050224, 163733}, {6055087,	20050225,  23504},
  {6056064,	20050226,  30130}, {6057044,	20050226, 120455}, {6057045,	20050226, 120849},
  {6057061,	20050226, 213328}, {6057089,	20050227,  31649}, {6058012,	20050227,  81653},
  {6058034,	20050227, 151947}, {6058060,	20050227, 213739}, {6058083,	20050228,  31937},
  {6059017,	20050228, 101606}, {6059058,	20050301,  22308}, {6059060,	20050301,  23343},
  {6060015,	20050301, 102410}, {6060016,	20050301, 103255}, {6060017,	20050301, 103609},
  {6060032,	20050301, 151134}, {6060033,	20050301, 151744}, {6060061,	20050301, 205041},
  {6061032,	20050302,  91930}, {6062009,	20050303, 155647}, {6062010,	20050303, 160116},
  {6062011,	20050303, 160557}, {6062012,	20050303, 161036}, {6062016,	20050303, 163201},
  {6062017,	20050303, 164315}, {6062018,	20050303, 165154}, {6063050,	20050305,  15503},
  {6064038,	20050305, 120235}, {6064055,	20050305, 151405}, {6064083,	20050305, 223154},
  {6064101,	20050306,  33120}, {6065019,	20050306, 144259}, {6065020,	20050306, 144726},
  {6065040,	20050306, 211045}, {6065057,	20050307,   3049}, {6069011,	20050310,  83948},
  {6069050,	20050310, 142906}, {6069051,	20050310, 143546}, {6069052,	20050310, 144033},
  {6069053,	20050310, 144339}, {6069096,	20050311,   4050}, {6070008,	20050311,  83919},
  {6070054,	20050311, 145137}, {6070055,	20050311, 145622}, {6070056,	20050311, 150148},
  {6070082,	20050312,   5732}, {6071009,	20050312,  73517}, {6071041,	20050312, 144500},
  {6071070,	20050312, 211742}, {6071090,	20050313,  30411}, {6072016,	20050313, 101722},
  {6072036,	20050313, 172954}, {6073011,	20050314,  93720}, {6073040,	20050314, 152923},
  {6073041,	20050314, 153521}, {6073042,	20050314, 153951}, {6073068,	20050314, 210618},
  {6073069,	20050314, 211134}, {6073070,	20050314, 211411}, {6073071,	20050314, 211654},
  {6074001,	20050315,  52118}, {6074021,	20050315, 131421}, {6074022,	20050315, 131634},
  {6074085,	20050315, 221841}, {6074086,	20050315, 222244}, {6075017,	20050316,  65929},
  {6075039,	20050316, 124811}, {6075129,	20050317,  10452}, {6075150,	20050317,  42414},
  {6076026,	20050317,  93921}, {6076028,	20050317,  94346}, {6076061,	20050317, 181644},
  {6076096,	20050318,    711}, {6076120,	20050318,  50016}, {6077035,	20050318, 110515},
  {6077066,	20050318, 192434}, {6078010,	20050319,  62423}, {6078040,	20050319, 122635},
  {6078069,	20050319, 185246}, {6078081,	20050319, 220211}, {6079006,	20050320,  62136},
  {6079018,	20050320,  81738}, {6079050,	20050320, 142834}, {6079099,	20050320, 203752},
  {6079100,	20050320, 204000}, {6079122,	20050321,  13809}, {6080008,	20050321,  63242},
  {6080022,	20050321, 102111}, {6080029,	20050321, 114633}, {6080044,	20050322,  23925},
  {6081015,	20050322,  75613}, {6081016,	20050322,  80308}, {6081036,	20050322, 134731},
  {6081037,	20050322, 134945}, {6081068,	20050322, 190310}, {6081069,	20050322, 190439},
  {6081070,	20050322, 191041}, {6081071,	20050322, 191914}, {6082013,	20050323,  73716},
  {6082035,	20050323, 120114}, {6082061,	20050323, 164504}, {6082062,	20050323, 165231},
  {6082063,	20050323, 165543}, {6082064,	20050323, 165836}, {6082065,	20050323, 170152},
  {6082086,	20050323, 205618}, {6082087,	20050323, 205800}, {6082088,	20050323, 210216},
  {6082089,	20050323, 210511}, {6082102,	20050324,  34209}, {6083016,	20050324,  90321},
  {6099019,	20050409,  85650}, {6099021,	20050409,  90847}, {6099030,	20050409, 132907},
  {6099031,	20050409, 134243}, {6099034,	20050409, 134723}, {6099035,	20050409, 141558},
  {6099036,	20050409, 143038}, {6099050,	20050410,   3633}, {6099051,	20050410,   3903},
  {6099052,	20050410,   3929}, {6099053,	20050410,   4307}, {6101001,	20050411,  54223},
  {6101002,	20050411,  54330}, {6101014,	20050411,  90306}, {6105023,	20050415, 182140},
  {6105024,	20050415, 182259}, {6106021,	20050416,  91204}, {6107020,	20050417, 104429},
  {6107035,	20050417, 133849}, {6108008,	20050418,  53849}, {6109039,	20050419, 112937},
  {6109052,	20050419, 152133}, {6109056,	20050419, 153010}, {6109083,	20050419, 194631},
  {6109084,	20050419, 200110}, {6109085,	20050419, 201957}, {6110002,	20050420,  45014},
  {6110014,	20050421,   1829}, {6110015,	20050421,   2607}, {6110016,	20050421,   3213},
  {6111007,	20050421,  60504}, {6111017,	20050421, 104636}, {6111032,	20050421, 151654},
  {6111033,	20050421, 152549}, {6111054,	20050421, 212808}, {6111073,	20050422,  23443},
  {6112010,	20050422, 200241}, {6112021,	20050423,   2305}, {6113011,	20050423,  52042},
  {6113024,	20050423,  80202}, {6113057,	20050423, 222127}, {6113075,	20050424,  22953},
  {6114008,	20050424, 173605}, {6114018,	20050424, 212250}, {6114020,	20050424, 213053},
  {6114036,	20050425,  25448}, {6115011,	20050425,  70859}, {6115031,	20050425, 131911},
  {6115046,	20050425, 180044}, {6115047,	20050425, 180625}, {6116003,	20050426,  40633},
  {6116030,	20050426, 103320}, {6116055,	20050426, 170321}, {6116056,	20050426, 170844},
  {6116082,	20050427,    458}, {6117004,	20050427,  42637}, {6117005,	20050427,  42910},
  {6117007,	20050427,  43448}, {6117008,	20050427,  43732}, {6117021,	20050427, 103052},
  {6117043,	20050427, 150715}, {6119018,	20050429, 120615}, {6119019,	20050429, 121135},
  {6119061,	20050429, 213242}, {6120012,	20050430,  83005}, {6120013,	20050430,  83351},
  {6120021,	20050430, 113332}, {6120048,	20050430, 205906}, {6120069,	20050501,  12104},
  {6121011,	20050501,  70001}, {6121032,	20050501, 140437}, {6121064,	20050502,  13107},
  {6121065,	20050502,  13722}, {6122012,	20050502,  80444}, {6123015,	20050503,  54300},
  {6123043,	20050504,  15842}, {6124005,	20050504,  60356}, {6124014,	20050504, 100439},
  {6125007,	20050505, 142041}, {6125008,	20050505, 142256}, {6126041,	20050506, 130912},
  {6126074,	20050507,   1521}, {6127001,	20050507,  41412}, {6127013,	20050507, 100529},
  {6127033,	20050507, 161725}, {6127045,	20050507, 204935}, {6127062,	20050508,  35402},
  {6127063,	20050508,  35551}, {6127064,	20050508,  35910}, {6128020,	20050508,  80031},
  {6128034,	20050508, 111445}, {6128047,	20050508, 161231}, {6128049,	20050508, 161809},
  {6130014,	20050510,  81619}, {6130031,	20050510, 145114}, {6130058,	20050510, 233019},
  {6131014,	20050511,  63620}, {6131050,	20050511, 103423}, {6131058,	20050511, 123205},
  {6131059,	20050511, 123817}, {6131095,	20050511, 173413}, {6132013,	20050512,  53418},
  {6133007,	20050513,  43418}, {6133032,	20050513,  95629}, {6133037,	20050513, 145410},
  {6133038,	20050513, 145628}, {6133067,	20050514,  30500}, {6134030,	20050514, 110929},
  {6134045,	20050514, 150348}, {6134065,	20050514, 211423}, {6134087,	20050515,  30247},
  {6134088,	20050515,  30729}, {6135011,	20050515,  70352}, {6136021,	20050516,  90655},
  {6136038,	20050516, 130557}, {6136039,	20050516, 131204}, {6136067,	20050516, 223207},
  {6136068,	20050516, 223319}, {6136069,	20050516, 223549}, {6136070,	20050516, 223811},
  {6136071,	20050516, 224115}, {6136072,	20050516, 224442}, {6136073,	20050516, 224729},
  {6136078,	20050516, 231738}, {6136079,	20050516, 231950}, {6136080,	20050516, 232031},
  {6137001,	20050517,  41316}, {6137002,	20050517,  41458}, {6137003,	20050517,  41644},
  {6137004,	20050517,  41933}, {6137005,	20050517,  42749}, {6137006,	20050517,  42912},
  {6137007,	20050517,  43258}, {6137008,	20050517,  43411}, {6137083,	20050517, 124747},
  {6137168,	20050518,  21818}, {6138016,	20050518, 101616}, {6138065,	20050519,  33530},
  {6138066,	20050519,  34338}, {6139023,	20050519, 120534}, {6139058,	20050520,  14655},
  {6139059,	20050520,  15059}, {6140027,	20050520, 110635}, {6140073,	20050521,  20031},
  {6141025,	20050521, 131125}, {6141057,	20050521, 214358}, {6141067,	20050522,   4129},
  {6142009,	20050522,  63128}, {6142047,	20050522, 170949}, {6142058,	20050522, 200906},
  {6142086,	20050523,  20942}, {6143003,	20050523,  50253}, {6143020,	20050523, 101250},
  {6143030,	20050523, 125256}, {6143031,	20050523, 125921}, {6143032,	20050523, 130548},
  {6143034,	20050523, 134931}, {6143035,	20050523, 135521}, {6144018,	20050524,  71505},
  {6144055,	20050524, 225539}, {6144064,	20050525,  15802}, {6145016,	20050525,  85613},
  {6145026,	20050525, 115732}, {6145046,	20050525, 193421}, {6145059,	20050525, 223734},
  {6145060,	20050525, 224253}, {6146022,	20050526, 101203}, {6146060,	20050527,  35942},
  {6147022,	20050527, 201730}, {6147023,	20050527, 202335}, {6147032,	20050527, 231842},
  {6148015,	20050528,  75451}, {6148025,	20050528, 105359}, {6148061,	20050529,  24253},
  {6149008,	20050529,  55308}, {6149022,	20050529, 104721}, {6149033,	20050529, 135452},
  {6149053,	20050529, 232129}, {6150020,	20050530,  94806}, {6151006,	20050531,  54632},
  {6151016,	20050531,  84615}, {6151027,	20050531, 115415}, {6154012,	20050603,  61035},
  {6154033,	20050603, 114600}, {6155002,	20050604,  43128}, {6155028,	20050605,  33815},
  {6156017,	20050605,  75933}, {6156032,	20050605, 124310}, {6156033,	20050605, 124747},
  {6156035,	20050605, 130736}, {6156068,	20050606,   2849}, {6156075,	20050606,  32518},
  {6157013,	20050606,  91843}, {6157024,	20050606, 121858}, {6157025,	20050606, 122427},
  {6157029,	20050606, 203629}, {6157030,	20050606, 203721}, {6157053,	20050607,  23124},
  {6158022,	20050607,  71904}, {6158080,	20050607, 230756}, {6160002,	20050609,  42701},
  {6160015,	20050609,  73612}, {6160051,	20050609, 175052}, {6160063,	20050609, 205137},
  {6161008,	20050610,  53838}, {6161048,	20050610, 164820}, {6161095,	20050611,   5508},
  {6162003,	20050611,  41434}, {6162033,	20050611, 123542}, {6162034,	20050611, 124043},
  {6162036,	20050611, 124916}, {6162066,	20050612,    624}, {6162077,	20050612,  30608},
  {6163019,	20050612, 131752}, {6163046,	20050613,  10622}, {6164001,	20050613,  40533},
  {6164019,	20050613, 121312}, {6165048,	20050614, 223421}, {6165064,	20050615,  13624},
  {6166019,	20050615, 110924}, {6166062,	20050615, 165858}, {6166063,	20050615, 170619},
  {6166097,	20050616,  21254}, {6167018,	20050616,  51148}, {6167078,	20050616, 112049},
  {6167122,	20050616, 232914}, {6167135,	20050617,  23557}, {6168033,	20050617, 103151},
  {6168080,	20050617, 205013}, {6168092,	20050617, 235017}, {6168094,	20050618,     33},
  {6168106,	20050618,  25017}, {6169005,	20050618,  55010}, {6169033,	20050618, 132026},
  {6169054,	20050618, 162712}, {6169086,	20050618, 233508}, {6169100,	20050619,  23622},
  {6170008,	20050619,  53510}, {6170042,	20050619, 141945}, {6170053,	20050619, 171756},
  {6170078,	20050620,  22135}, {6171004,	20050620,  52004}, {6171035,	20050620, 144124},
  {6171036,	20050620, 144910}, {6171047,	20050620, 174123}, {6172005,	20050621,  53249},
  {6172072,	20050621, 231106}, {6172089,	20050622,  21532}, {6172090,	20050622,  21951},
  {6173018,	20050622,  83002}, {6173029,	20050622, 113509}, {6173067,	20050622, 223445},
  {6173076,	20050623,  13532}, {6174016,	20050623,  95503}, {6174028,	20050623, 130156},
  {6174050,	20050623, 224453}, {6174061,	20050624,  14510}, {6174063,	20050624,  15144},
  {6175014,	20050624, 110400}
};
static const Int_t NRunTime = sizeof(RuntTime)/sizeof(RunTime_t);
//________________________________________________________________________________
void MakeTable() {
  date = Time = 0;
  for (Int_t i = 0; i < NRunTime; i++) {
    if (run == RuntTime[i].runNumber) {
      date = RuntTime[i].beginDate;
      Time = RuntTime[i].beginTime;
      break;
    }
  }
  TString fOut =  Form("tpcDriftVelocity.%8i.%06i.C",date,Time);
  ofstream out;
  cout << "Create " << fOut << endl;
  out.open(fOut.Data());
  out << "TDataSet *CreateTable() {" << endl;
  out << "  if (!gROOT->GetClass(\"St_tpcDriftVelocity\")) return 0;" << endl;
  out << "  St_tpcDriftVelocity *tableSet = new St_tpcDriftVelocity(\"tpcDriftVelocity\",1);" << endl;
  out << "  tpcDriftVelocity_st row;// Laser Run " << run << endl;
  out << "  row.laserDriftVelocityEast	 =   " << DVAll[1][0] << "; // +/- " << dDVAll[1][0] << " cm/us All: East = " << DVAll[1][2] << " +/- " << dDVAll[1][2] << endl;
  out << "  row.laserDriftVelocityWest	 =   " << DVAll[1][0] << "; // +/- " << dDVAll[1][0] << " cm/us All: West = " << DVAll[1][1] << " +/- " << dDVAll[1][1] << endl;
  out << "  row.cathodeDriftVelocityEast	 =          0; // cm/us : from cathode emission  ;" << endl;
  out << "  row.cathodeDriftVelocityWest	 =          0; // cm/us : from cathode emission  ;" << endl;
  out << "  tableSet->AddAt(&row);// 1e3*Delta: All = " << DVAll[0][0] << " +/- " << dDVAll[0][0] << endl;
  out << "  return (TDataSet *)tableSet;//" 
      << " West = " << DVAll[0][1] << " +/- " << dDVAll[0][1]
      << " East = " << DVAll[0][2] << " +/- " << dDVAll[0][2] << endl;
  out << "};" << endl;
}
//________________________________________________________________________________
void Slopes(Int_t n1 = 1, Int_t n2 = 9999) {
  Int_t NF = 0;
  TSeqCollection *files = gROOT->GetListOfFiles();
  Int_t nn = files->GetSize();
  if (! nn) return;
  TFile **Files = new TFile *[nn];
  //  TString FileNames[nn]; 
  if (! files) return;
  TIter next(files);
  TFile *f = 0;
  Int_t l = 0;
  while ( (f = (TFile *) next()) ) { 
    TTree *laser = (TTree *) f->Get("laser");
    if (! laser) continue;
    Long64_t n = laser->Draw("fFit.dslope","fFit.dslope > 0 && fFit.dslope <0.03","goff");
    if (n < 100) {
      cout << "Skip file " << f->GetName() << endl;
    } else {
      l++;
      if (l >=  n1 && l <= n2) {
	cout << l << " Add file " << f->GetName() << endl;
	//	FileNames[NF] = f->GetName();
	Files[NF] = f;
	NF++;
      }
      //      delete f;
    }
  }
  if (!NF) return;
  Int_t ny = (Int_t) TMath::Sqrt(NF);
  Int_t nx = NF/ny;
  if (nx*ny != NF) nx++;
  cout << "NF = " << NF << " nx " << nx << " ny " << ny << endl;
  TCanvas *c[2];
  c[0] = new TCanvas(Form("Slopes %i",n1),Form("Slopes %i",n1));  
  c[1] = new TCanvas(Form("LDV %i",n1),Form("Laser Drift Velocities %i",n1));
  c[0]->Divide(nx,ny);
  c[1]->Divide(nx,ny);
  for (Int_t i = 0; i < NF; i++) {
    memset(&DVAll[0][0], 0, 6*sizeof(Double_t));
    memset(&dDVAll[0][0], 0, 6*sizeof(Double_t));
    f = Files[i];
    //    f = TFile::Open(FileNames[i]);
    if (! f) continue;
    cout << "i = " << i << " " << f->GetName() << endl;
    f->cd();
    TTree *laser = (TTree *) f->Get("laser");
    if (! laser) {
      cout << "Did not find TTree laser in " << f->GetName() << endl;
      continue;
    }
    laser->SetMarkerStyle(20);
    laser->Draw("fEvtHdr.fRun:fEvtHdr.fDate:fEvtHdr.fTime","","goff",1);
    run = (Int_t) laser->GetV1()[0];
    date = (Int_t) laser->GetV2()[0];
    Time = (Int_t) laser->GetV3()[0];
    cout << "Run = " << run << " date = " << date << " Time = " << Time << endl;
    //    Int_t color = i+1;
    //    laser->SetMarkerColor(color);
    TString histN, plot, plotW,  Plot, Plot2, profN;
    TString plotE;
    TString cut("fFit.dslope > 0 && fFit.dslope <0.03");
    TString CutW(cut); CutW += " && fFit.Sector < 13";
    TString CutE(cut); CutE += " && fFit.Sector > 12";
    Char_t *cutName[3] = {"All ","West","East"};
    Char_t *plName[2] = {"SS", "dV"};
    Char_t *FMT[2] = {"%s dV = (%7.2f +/- %7.2f) x 10^3","%s dV = (%10.5f +/- %10.5f) cm/mksec"};
    for (Int_t l = 0; l < 2; l++) {
      c[l]->cd(i+1)->SetLogz(1);
      histN = Form("%s%i",plName[l],run);
      if (l == 0) {
	plotW  = "1e3*fFit.slope:fFit.Sector>>";
	plotE  = "1e3*(fFit.slope+3.63518e-04):fFit.Sector>>+";
      } else {
	plotW = "1e-6*fEvtHdr.fOnlClock/fEvtHdr.fClock*fEvtHdr.fDriVel/(1.+fFit.slope-fEvtHdr.fOnlClock/fEvtHdr.fClock*fEvtHdr.fDriVel/TMath::Ccgs()):fFit.Sector>>";
	plotE = "1e-6*fEvtHdr.fOnlClock/fEvtHdr.fClock*fEvtHdr.fDriVel/(1.+fFit.slope+3.63518e-04-fEvtHdr.fOnlClock/fEvtHdr.fClock*fEvtHdr.fDriVel/TMath::Ccgs()):fFit.Sector>>+";
      }
      Plot  = plotW;
      profN = histN;
      profN += "_pfx";
      Plot += profN;
      Plot += "(24,1,25)";
      Long64_t n = laser->Draw(Plot,CutW,"prof");
      Plot = plotE; Plot += profN;
      n += laser->Draw(Plot,CutE,"prof");
      if (n < 10) {
	cout << f->GetName() << " empty only " << n << " entries" << endl;
	continue;
      }
      TProfile *SSp = (TProfile *) gDirectory->Get(profN);
      if (! SSp) continue;
      if (SSp->GetEntries() <= 10) {
	cout << SSp->GetName() << " empty only " << n << " entries" << endl;
	continue;
      }
      Plot2 = plotW; 
      Plot2 += histN;
      SSp->SetMarkerColor(3);
      Double_t ymin = SSp->GetMean(2) - 3*SSp->GetRMS(2);
      Double_t ymax = SSp->GetMean(2) + 3*SSp->GetRMS(2);
      Plot2 += Form("(24,1,25,100,%f,%f)",ymin,ymax);
      laser->Draw(Plot2,CutW,"colz");
      Plot2 = plotE;
      Plot2 += histN;
      laser->Draw(Plot2,CutE,"colz");
      TH2F *SS = (TH2F *) gDirectory->Get(histN);
      if (! SS) {
	cout << "Did not find histogram " << histN << endl;
	continue;
      }
      SS->FitSlicesY();
      TString fitN(histN);
      fitN += "_1";
      TH1D *fit = (TH1D *) gDirectory->Get(fitN);
      TLegend *leg = new TLegend(0.1,0.1,0.55,0.25,"");
      if (fit) {
	fit->SetMarkerStyle(20);
	TF1 *pol0 = (TF1*) gROOT->GetFunction("pol0");
	if (pol0) {
	  for (Int_t k = 0; k < 3; k++) {
	    pol0->SetLineColor(k+1);
	    if (k == 0) fit->Fit(pol0,"er","",1,25); 
	    if (k == 1) fit->Fit(pol0,"er+","",1,13);
	    if (k == 2) fit->Fit(pol0,"er+","",13,25);
	    DVAll[l][k]  = pol0->GetParameter(0);
	    dDVAll[l][k] = pol0->GetParError(0);
	    if (!l || dDVAll[l][k] > 0 && dDVAll[l][k]< 1e-3)
	      leg->AddEntry((TF1 *) fit->GetListOfFunctions()->Last(), Form(FMT[l],cutName[k],DVAll[l][k],dDVAll[l][k]));
	  }
	}
      }
      SS->SetTitle(Form("Run: %i",run));
      SS->SetXTitle("Sector");
      SS->SetYTitle("Drift Velocity ");
      SS->Draw("colz");
      if (SSp) SSp->Draw("same");
      if (fit) fit->Draw("same");
      if (l && DVAll[l][0] > 0) {
	if (DVAll[l] > 5.5 &&  dDVAll[l][0] > 0 && dDVAll[l][0]< 1e-3) MakeTable();
	else {
	  cout << "File " << f->GetName() << " fails =============================" << endl;
	  leg->AddEntry(fit, "Rejected");
	}
      }
      leg->Draw();
      c[l]->Update();
    }
  }
}
#if 0
//________________________________________________________________________________
void Offsets() {
  Int_t NF = 0;
  TSeqCollection *files = gROOT->GetListOfFiles();
  Int_t nn = files->GetSize();
  if (! nn) return;
  TFile **Files = new TFile *[nn];
  if (! files) return;
  TIter next(files);
  TFile *f = 0;
  while ( (f = (TFile *) next()) ) { 
    TTree *laser = (TTree *) f->Get("laser");
    if (! laser) continue;
    cout << "Add " << f->GetName() << endl;
    Files[NF] = f; NF++;
  }
  Int_t ny = (Int_t) TMath::Sqrt(NF);
  Int_t nx = NF/ny;
  if (nx*ny != NF) nx++;
  TCanvas *c1 = new TCanvas("Offsets","Offsets");
  c1->Divide(nx,ny);
  for (Int_t i = 0; i < NF; i++) {
    c1->cd(i+1);
    f = Files[i];
    if (! f) continue;
    TTree *laser = (TTree *) f->Get("laser");
    if (! laser) continue;
    laser->SetMarkerStyle(20);
    //    Int_t color = i+1;
    //    laser->SetMarkerColor(color);
    laser->Draw(Form("abs(fFit.offset)-6.66274:fFit.Sector>>OS%i(24,1,25)",i),"fFit.doffset > 0 && fFit.doffset <5","prof");
    TProfile *OS = (TProfile *) gDirectory->Get(Form("OS%i",i));
    TString Name(gSystem->BaseName(f->GetName()));
    Name.ReplaceAll(".root","");
    Name.ReplaceAll("laser_","Run ");
    cout << Name  << " i = " << i << endl;
    OS->SetTitle(Name);
    OS->SetXTitle("Sector");
    OS->SetYTitle("dZ(cm)");
    OS->Draw();
    c1->Update();
    //    Int_t j;
    //    cin >> j;
  }
}
#endif
//________________________________________________________________________________
void Laser(){
  Slopes();
}
