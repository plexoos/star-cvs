// $Id: StEEmcFastMaker.h,v 1.7 2005/06/09 20:04:23 balewski Exp $


/* \class StEEmcFastMaker        
\author Jan Balewski

 Fast simulator of the E-EMC tower response converts energy loss in the tower tails generated by GEANT directly to ADC using eta-dependent conversion factor. The following assumptions are made:

   <li> energy deposit in any tail is equal to the sum of contribution from all particles passing its volume. Number of fibers within the tail and type of scintillator is ignored.
   <li> all fibers transport to PMT 100% of energy deposited, except tails with a total deposit below 100 keV.
   <li> total Geant energy deposit is recorded as in StEvent
   <li> ADC=4095 * geantEnergy /0.05 /60GeV / cosh(eta) is recorded as in StEvent 

<pre>
 Details of the code
-----------------------------

Decoding of E-EMC hits in StEvent
<hr>
 __ENDCAP__        
   TOWERS: det = kEndcapEmcTowerId
     sector 1-12   -->module 0-11
     subsector A-E -->submodule 0-4  
     jeta 1-12     -->eta  0-11
  
   PRE1-, PRE2-, POST-shower: all det = kEndcapEmcPreshowerId
     sector,subsector,eta : the same
     add 0, 5, or 10 to submodule for PRE1-, PRE2-, POST-shower

   SmdU : det=kEndcapSmdUStripId
   SmdV : det=kEndcapSmdVStripId
     sector 1-12    -->module 0-11
     stripID 1-288  -->eta 0-287
                    -->submodule=0 (not used)

---------------------------------------
StEEmcFastMaker::Make() {

 EEmcMCData  *evIN->readEventFromChain(this); // acquire E-EMC hit/track list

 EEevent eeveRaw; 
 evIN->write(&eeveRaw); // copy E-EMC hit/track to local TTree

 EEevent  eeveRaw.sumRawMC(eeve); //convert it to hit/tail list

  EE2ST(eeve, stevent); // add hit/tail list to StEvent

}

----------------------------------
usage in bfc.C
  

 StEEmcFastMaker *myMk=new StEEmcFastMaker;
 Char_t *after = "BbcSimulation";
 StMaker *xMk = chain->GetMaker(after);
 assert(xMk);
 chain->AddAfter(after,myMk);

</pre>
Exampl how to read back E-EMC data from StEvent:
www.star.bnl.gov/STAR/eemc -->How To

*/

#ifndef STAR_StEEmcFastMaker
#define STAR_StEEmcFastMaker


#ifndef StMaker_H
#include "StMaker.h"
#endif
class EEeventDst;
class StEvent;
class EEmcMCData;
class StEmcCollection;

/* Translation of StEmcCollection names:  EEMC -->BEMC

  WARN: preserve sub<16=2^4, eta<512=2^9, mod<128=2^7

 Jan
*/


class StEEmcFastMaker : public StMaker {

 public:
   
  Float_t   getSamplingFraction();
  Float_t  *getTowerGains();
  Float_t   getSmdGain();
  Float_t   getPreshowerGain();

  Int_t getMaxAdc() { return maxAdc; } // [ADC channels]
  Int_t getMaxET() { return maxEtot; } // [GeV]

 private:

  Int_t maxAdc;
  Int_t maxEtot;

  EEmcMCData  *mevIN; ///< decoded raw .fzd event
  EEeventDst *meeve;    ///<  result stored in TTRee 

  void mEE2ST(EEeventDst*, StEmcCollection* emcC); ///< TTree-->StEvent

  float msamplingFraction; ///< for Towers
  float * mfixTgain; ///<  (adc=g*de )ideal gains for Towers
  float mfixPgain; ///< (adc=g*de ) fixed gain for pre/post shower
  float mfixSMDgain; ///< (adc=g*de ) fixed gain for SMD

  StEmcCollection *mLocalStEmcCollection; // for special uses (embedding)
  bool mEmcCollectionIsLocal;

  // static Char_t  m_VersionCVS = "$Id: StEEmcFastMaker.h,v 1.7 2005/06/09 20:04:23 balewski Exp $";
  
 protected:
 public: 
  StEEmcFastMaker(const char *name="EEmcFastSim");
  virtual       ~StEEmcFastMaker();
  virtual Int_t Init();
  virtual Int_t  Make();
  virtual void Clear(Option_t *option="");
 
  void SetLocalStEvent();
  void SetSamplingFraction(float x){ msamplingFraction=x;}; ///<default 0.05
  void SetEmcCollectionLocal(bool x=true){mEmcCollectionIsLocal=x;}
  StEmcCollection * GetEmcCollection() { return mLocalStEmcCollection;}

  virtual const char *GetCVS() const {
    static const char cvs[]="Tag $Name:  $ $Id: StEEmcFastMaker.h,v 1.7 2005/06/09 20:04:23 balewski Exp $ built "__DATE__" "__TIME__ ; 
    return cvs;
  }
  
  ClassDef(StEEmcFastMaker,0)   
};
    
#endif


// $Log: StEEmcFastMaker.h,v $
// Revision 1.7  2005/06/09 20:04:23  balewski
// upgrade for embedding
//
// Revision 1.6  2005/06/03 19:20:47  balewski
// *** empty log message ***
//
// Revision 1.5  2004/05/26 21:28:37  jwebb
// o Changes to StEEmcFastMaker to provide methods to get sampling fraction,
//   gains, etc...
//
// o StMuEEmcSimuMaker is now just a shell of its former self
//
// o Added StMuEEmcSimuReMaker.  This maker takes a muDst as input, and uses
//   the database maker to "massage" the ADC response, to better simulate
//   the calorimeter as installed.  For now, it simply uses the geant
//   energy response, combined with a single sampling fraction and the
//   database gains and pedestals to come up with a new ADC response.
//
// Revision 1.4  2004/04/08 21:33:49  perev
// Leak off
//
// Revision 1.3  2003/09/10 19:47:08  perev
// ansi corrs
//
// Revision 1.2  2003/02/20 05:15:51  balewski
// *** empty log message ***
//
// Revision 1.1  2003/01/28 23:12:59  balewski
// star
//
