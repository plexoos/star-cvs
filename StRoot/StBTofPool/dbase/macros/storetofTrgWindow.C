// macro to upload tofr5 INL tables to database
//
// based on
//  http://www.star.bnl.gov/STAR/comp/db/StoreDbTable.cc.html
//
// Jing Liu, 02/18/2005 
//

 
// #include "StDbLib/StDbManager.hh"
// #include "StDbLib/StDbConfigNode.hh"
// #include "StDbLib/StDbTable.h"
// #include "StDbLib/StDbDefs.hh"

#include <iostream>
#include <fstream>
#include <string>
#include <iomanip>
using namespace std;


void storetofTrgWindow() {

// year8
//  const Int_t NTRAY = 5;
// year9
//  const Int_t NTRAY = 94;
// year10+
  const Int_t NTRAY = 120;
  const Int_t NVPDTRAY = 2;
  const Int_t NMAX = 120;
  const Int_t NMTD = 2; //there is only one MTD, but it has ID=124 (and is only used in Run 10)

  //-- load dBase and Table definition libraries
  gSystem->Load("St_base");
  gSystem->Load("StChain");
  gSystem->Load("StUtilities");
  gSystem->Load("St_Tables.so");
  gSystem->Load("StDbLib.so");
  gSystem->Load("libStDb_Tables.so");

  //-- get the singleton manager
  StDbManager* dbManager = StDbManager::Instance();

  //-- connect to the db & get an empty container
  StDbConfigNode* configNode = dbManager->initConfig("Calibrations_tof");

//----------------------------------------
// History of time stamps (in GMT)
//----------------------------------------
//  TString ZStoreTime = "2007-11-01 00:00:01";
//  TString ZStoreTime = "2009-02-01 00:00:00";  // y9 1st version very loose
//  TString ZStoreTime = "2009-02-01 00:00:01";  // y9 2st version  
//  TString ZStoreTime = "2009-03-26 00:00:00";  // y9 500GeV day 85-92
//  TString ZStoreTime = "2009-04-23 21:00:00";  // 10113066-10146091
//  TString ZStoreTime = "2009-05-27 00:00:00";  // 10147124-10149036
//  TString ZStoreTime = "2009-05-29 14:00:00";  // 10149077-10150023
//  TString ZStoreTime = "2009-05-30 15:30:00";  // 10150024-10152010
//  TString ZStoreTime = "2009-06-03 16:00:00";  // 10154045-...
//
//  TString ZStoreTime = "2009-11-01 00:00:00"; // run 10 preliminary
//  TString ZStoreTime = "2009-11-01 00:01:00"; // updated version, includes MTD
//  TString ZStoreTime = "2009-11-01 00:01:01"; // updated version, (2nd attempt)includes MTD
//  TString ZStoreTime = "2010-12-10 00:00:00"; // run 11 new timing (TOCK)
//  TString ZStoreTime = "2011-12-20 00:00:01"; // run 12 new timing
//  TString ZStoreTime = "2012-03-21 19:50:00"; // run 12 new VPD timing (effective from run 13081013)
  TString ZStoreTime = "2012-03-21 19:50:01"; // run 12 new VPD timing (corrected, effective from run 13081013)


  //-- add table to the container with descriptor given by Database
  StDbTable* tofTrgWindow = configNode->addDbTable("tofTrgWindow");

  //-- fill structures & store times
  tofTrgWindow_st *trg = new tofTrgWindow_st[NMAX+NVPDTRAY+NMTD];

// year 10
// unsigned short cutlow[124]={
// 2828,2825,2826,2826,2832,2831,2835,2831,2836,2832,2832,2829,2833,2830,2833,
// 2831,2824,2826,2825,2824,2827,2836,2833,2830,2829,2831,2838,2833,2837,2838,
// 2836,2838,2850,2841,2847,2845,2845,2846,2843,2838,2837,2836,2835,2835,2829,
// 2824,2830,2829,2828,2827,2806,2807,2807,2814,2815,2818,2813,2821,2826,2828,
// 2891,2901,2891,2894,2891,2897,2894,2900,2899,2899,2898,2904,2905,2904,2898,
// 2904,2907,2912,2916,2916,2908,2914,2908,2914,2903,2902,2907,2901,2901,2898,
// 2895,2894,2897,2896,2896,2906,2903,2908,2907,2914,2911,2698,2913,2915,2915,
// 2916,2914,2913,2913,2912,2914,2909,2905,2908,2902,2898,2902,2895,2899,2899,
// 2857,2921,0,2900};
// unsigned short cuthi[124]={
// 2903,2900,2901,2901,2907,2906,2910,2906,2911,2907,2907,2904,2908,2905,2908,
// 2906,2899,2901,2900,2899,2902,2911,2908,2905,2904,2906,2913,2908,2912,2913,
// 2911,2913,2925,2916,2922,2920,2920,2921,2918,2913,2912,2911,2910,2910,2904,
// 2899,2905,2904,2903,2902,2881,2882,2882,2889,2890,2893,2888,2896,2901,2903,
// 2966,2976,2966,2969,2966,2972,2969,2975,2974,2974,2973,2979,2980,2979,2973,
// 2979,2982,2987,2991,2991,2983,2989,2983,2989,2978,2977,2982,2976,2976,2973,
// 2970,2969,2972,2971,2971,2981,2978,2983,2982,2989,2986,2773,2988,2990,2990,
// 2991,2989,2988,2988,2987,2989,2984,2980,2983,2977,2973,2977,2970,2974,2974,
// 2932,2996,0,2975};

// year 11
//unsigned short cutlow[124]={
//2816,2817,2813,2817,2820,2822,2820,2823,2823,2813,2820,2824,2820,2817,2825,
//2824,2815,2813,2810,2816,2824,2824,2823,2825,2698,2820,2831,2832,2828,2829,
//2830,2837,2839,2835,2840,2837,2840,2838,2840,2834,2836,2824,2826,2830,2822,
//2808,2822,2823,2824,2823,2799,2800,2799,2798,2809,2811,2810,2793,2803,2816,
//2890,2892,2886,2885,2879,2889,2886,2887,2891,2892,2883,2892,2895,2883,2897,
//2884,2904,2904,2902,2889,2901,2904,2904,2902,2884,2897,2895,2892,2895,2889,
//2885,2881,2887,2890,2886,2898,2900,2901,2902,2908,2910,2698,2907,2909,2910,
//2907,2908,2907,2906,2901,2909,2898,2901,2898,2895,2899,2900,2887,2888,2887,
//2850,2913, 0,0};
//unsigned short cuthi[124]={
//2901,2902,2898,2902,2905,2907,2905,2908,2908,2898,2905,2909,2905,2902,2910,
//2909,2900,2898,2895,2901,2909,2909,2908,2910,2783,2905,2916,2917,2913,2914,
//2915,2922,2924,2920,2925,2922,2925,2923,2925,2919,2921,2909,2911,2915,2907,
//2893,2907,2908,2909,2908,2884,2885,2884,2883,2894,2896,2895,2878,2888,2901,
//2975,2977,2971,2970,2964,2974,2971,2972,2976,2977,2968,2977,2980,2968,2982,
//2969,2989,2989,2987,2974,2986,2989,2989,2987,2969,2982,2980,2977,2980,2974,
//2970,2966,2972,2975,2971,2983,2985,2986,2987,2993,2995,2783,2992,2994,2995,
//2992,2993,2992,2991,2986,2994,2983,2986,2983,2980,2984,2985,2972,2973,2972,
//2935,2998,0,0};

// year 12
unsigned short cutlow[124]={
2881,2873,2873,2873,2893,2876,2882,2878,2888,2881,2885,2878,2884,2876,2887,
2886,2877,2876,2880,2865,2804,2802,2799,2802,2798,2800,2810,2811,2807,2813,
2817,2812,2796,2806,2815,2812,2808,2809,2815,2807,2805,2811,2805,2803,2799,
2790,2801,2801,2804,2807,2860,2862,2862,2868,2871,2865,2870,2867,2872,2871,
2872,2864,2866,2864,2863,2868,2865,2871,2871,2862,2861,2867,2875,2871,2873,
2871,2878,2880,2888,2883,2883,2872,2884,2882,2874,2873,2874,2871,2867,2860,
2861,2866,2863,2863,2698,2876,2880,2879,2881,2878,2877,2698,2891,2890,2887,
2880,2891,2892,2881,2887,2885,2874,2877,2878,2874,2877,2888,2876,2874,2865,
2826,2889,0,0};
unsigned short cuthi[124]={
2966,2958,2958,2958,2978,2961,2967,2963,2973,2966,2970,2963,2969,2961,2972,
2971,2962,2961,2965,2950,2889,2887,2884,2887,2883,2885,2895,2896,2892,2898,
2902,2897,2881,2891,2900,2897,2893,2894,2900,2892,2890,2896,2890,2888,2884,
2875,2886,2886,2889,2892,2945,2947,2947,2953,2956,2950,2955,2952,2957,2956,
2957,2949,2951,2949,2948,2953,2950,2956,2956,2947,2946,2952,2960,2956,2958,
2956,2963,2965,2973,2968,2968,2957,2969,2967,2959,2958,2959,2956,2952,2945,
2946,2951,2948,2948,2783,2961,2965,2964,2966,2963,2962,2783,2976,2975,2972,
2965,2976,2977,2966,2972,2970,2959,2962,2963,2959,2962,2973,2961,2959,2950,
2911,2974,0,0};

// year 12 - updated VPD window to lower TOF deadtime (pp500 -- March 22, 2012)
//  cutlow[120]= 230 ; cuthi[120]= 290;  // VPD West
//  cutlow[121]= 245 ; cuthi[121]= 305;  // VPD East
// year 12 - correct updated VPD window to lower TOF deadtime (pp500 -- March 22, 2012, [5/1'12])
  cutlow[120]= 2834 ; cuthi[120]= 2919;  // VPD West
  cutlow[121]= 2896 ; cuthi[121]= 2981;  // VPD East



// ---------------------------------------------
//- Prepare table
  for(int i=0;i<NMAX+NVPDTRAY+NMTD;i++) {
    trg[i].trgWindow_Min = cutlow[i];
    trg[i].trgWindow_Max = cuthi[i];
    cout << " tray = " << i+1 << " min = " << trg[i].trgWindow_Min << " max = " << trg[i].trgWindow_Max << endl;
  }

// Store data in table
  tofTrgWindow->SetTable((char*)trg, NMAX+NVPDTRAY+NMTD);
//- set store time
  dbManager->setStoreTime(ZStoreTime.Data());
// Store table in dBase
  cout<<" here "<<endl;
  dbManager->storeDbTable(tofTrgWindow);
  cout<<"uploaded"<<endl;
}

