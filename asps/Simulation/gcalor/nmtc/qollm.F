* $Id: qollm.F,v 1.1.1.1 2004/01/15 00:08:49 potekhin Exp $
* $Name:  $
#include <commons/config.h>
      SUBROUTINE QOLLM
      IMPLICIT REAL *8  (A-H,O-Z)
#include "gcalor/cbert3.inc"
#include "gcalor/cisob2.inc"
      SAVE
C
      IF(IK)10,60,10
   10 UNIV=E(2)+COL(6)-COL(11)
      UNIVE=E(1)+COL(11)
      UNIVER=COL(1)+COL(6)
      K=16
      DO20 I=1,9,4
         COL(K)=(PXYZ(I)*UNIV-PXYZ(I+1)*UNIVE)/UNIVER
         COL(K+3)=(PXYZ(I)+PXYZ(I+1))/COL(1)
C     VX
   20 K=K+1
      COL(22)=(-PXYZ(9)*PXYZ(6))/COL(1)
C     QX
C     ABBREVIATED FORM SINCE PXYZ(1)=PXYZ(5)=0.0
      COL(23)=(PXYZ(2)*PXYZ(9))/COL(1)
C     QY
C     ABBREVIATED FORM SINCE PXYZ(1)=PXYZ(5)=0.0
      COL(24)=0.0
C     ABBREVIATED FORM SINCE PXYZ(1)=PXYZ(5)=0.0
      A=SNT/COL(14)
      B=A*COL(10)
C     (-BETA*COS PHI*SIN THETA/ALPHA + COS THETA)/P1P*P3P
      UNIV=COL(10)*(CST-A*SOPC*COL(13))/COL(12)
      UNIVE=B*SOPS/COL(12)
C     P3P*SIN PHI*SIN THETA/P1P*ALPHA
      UNIVER=(SOPC*B)+((E(3)+COL(9))/(COL(7)+1.0))
C     COS PHI*SIN THETA*P3P/ALPHA  +  (E3+E3P)/(1.0+GAMMA)
      K=19
      DO30 I=3,11,4
         PXYZ(I)=COL(K)*UNIVER+COL(K+3)*UNIVE+COL(K-3)*UNIV
   30 K=K+1
      DO40 I=1,9,4
   40 PXYZ(I+3)=PXYZ(I)+PXYZ(I+1)-PXYZ(I+2)
   50 RETURN
   60 DO70 I=16,17
         COL(I)=0.0
   70 COL(I+3)=0.0
      COL(18)=PXYZ(9)*PM(2)/COL(6)
C     P(1),Z *M2/M=P(BAR PRIME)1,Z
      COL(21)=PXYZ(9)/COL(1)
C     VZ VELOCITY
      DO80 I=22,24
   80 COL(I)=0.0
C     CROSS PRODUCT P1 PRIME X V
      PXYZ(3)=COL(10)*SNT*SOPC
C     X COMPONENT P3 BAR =P3 PRIME X SIN THETA X COS PHI
      PXYZ(7)=COL(10)*SNT*SOPS
C     Y COMP. P3 BAR =P3 PRIME X SIN THETA X SIN PHI
      PXYZ(11)=COL(10)*CST
      Z=PXYZ(9)/COL(6)
      PXYZ(11)=PXYZ(11)+(Z*PXYZ(9)*PXYZ(11))/(COL(1)+COL(6))+Z*COL(9)
C     Z COMP. P3 BAR=P3 PRIME COS THETA+(P1Z SQ*P3Z (PRIME)COS
C     THETA/(E PRIME*(E+E PRIME))+P1Z*E3 PRIME/E PRIME
      E(3)=DSQRT(PXYZ(3)*PXYZ(3)+PXYZ(7)*PXYZ(7)+PXYZ(11)*PXYZ(11)+
     +PM(3)*PM(3))
      DO90 I=1,9,4
   90 PXYZ(I+3)=PXYZ(I)-PXYZ(I+2)
      E(4)=DSQRT(PXYZ(4)*PXYZ(4)+PXYZ(8)*PXYZ(8)+PXYZ(12)*PXYZ(12)
     ++PM(4)*PM(4))
      IF(PT(38))50,100,50
  100 PT(3)=((E(4)-PM(4))/RCPMV)+PT(3)
      GOTO50
      END
