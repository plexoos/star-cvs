* $Id: cisob.F,v 1.1.1.1 2004/01/15 00:08:49 potekhin Exp $
* $Name:  $
#include <commons/config.h>
      SUBROUTINE CISOB
      IMPLICIT REAL *8  (A-H,O-Z)
C
#include "geant321/crandm.inc"
#include "gcalor/cbert3.inc"
#include "gcalor/cisob2.inc"
C
      INTEGER*2 RANDI
      REAL*8 DCLN(80),DCIN(115),PPAC(19),POAC(19),
     + FMXSN(161),FMXDN(130),FMXSP(117),PDCI(60),PDCH(55),DCHN(143),
     + DCHNA(36),DCHNB(60),PSPCL(158),PDPCL(130),SPCLN(158),DPCLN(130),
     + FSLN(176),FRINN(161),DMIN(101),PPSCL(117),PNSCL(117),PMSCL(117),
     + PNNSL(117),PCFSL(234),FRIPN(117),PNMI(101),PNFSL(234),PNEC(126),
     + PNNEC(126),PMXC(126),PMEC(126),PPEC(126),PEC(176),ECN(176),
     + PPDC(6426),PMDD(6426),PMDX(6426),PNDD(6426)
      REAL*8 CALCIN(3)
      EQUIVALENCE (TAPCRS(1),DCLN(1))    ,(TAPCRS(81),DCIN(1))   ,
     +            (TAPCRS(196),PPAC(1))  ,(TAPCRS(215),POAC(1))  ,
     +            (TAPCRS(234),FMXSN(1)) ,(TAPCRS(395),FMXDN(1)) ,
     +            (TAPCRS(525),FMXSP(1)) ,(TAPCRS(642),PDCI(1))  ,
     +            (TAPCRS(702),PDCH(1))  ,(TAPCRS(757),DCHN(1))  ,
     +            (TAPCRS(900),DCHNA(1)) ,(TAPCRS(936),DCHNB(1)) ,
     +            (TAPCRS(996),PSPCL(1)) ,(TAPCRS(1154),PDPCL(1)),
     +            (TAPCRS(1284),SPCLN(1)),(TAPCRS(1442),DPCLN(1)),
     +            (TAPCRS(1572),FSLN(1)) ,(TAPCRS(1748),FRINN(1))
C
      EQUIVALENCE (TAPCRS(1909),DMIN(1)) ,(TAPCRS(2010),PPSCL(1)),
     +            (TAPCRS(2127),PNSCL(1)),(TAPCRS(2244),PMSCL(1)),
     +            (TAPCRS(2361),PNNSL(1)),(TAPCRS(2478),PCFSL(1)),
     +            (TAPCRS(2712),FRIPN(1)),(TAPCRS(2829),PNMI(1)) ,
     +            (TAPCRS(2930),PNFSL(1)),(TAPCRS(3164),PNEC(1)) ,
     +            (TAPCRS(3290),PNNEC(1)),(TAPCRS(3416),PMXC(1)) ,
     +            (TAPCRS(3542),PMEC(1)) ,(TAPCRS(3668),PPEC(1)) ,
     +            (TAPCRS(3794),PEC(1))  ,(TAPCRS(3970),ECN(1))  ,
     +            (TAPCRS(4146),PPDC(1)) ,(TAPCRS(10572),PMDD(1)),
     +            (TAPCRS(16998),PMDX(1)),(TAPCRS(23424),PNDD(1))
C
      SAVE
      DATA NTER/0/
      IF(NTER.NE.0) GO TO 10
      NTER =1
      JP = 0
      IK = 0
      CASESN = 1.D0
      LN=2
      PNMS=.708E13
      SQNM=2.2638564E27
      DNCMS=4.758E13
      POMS=.684E13
      RCPMV=.50613E11
   10 CONTINUE
      LOOP=0
      INPT=0
      DO20 I=1,48
   20 PT(I)=0.0
      NOF  = 0
   30 BEGRU=0.0
      NOR=0
C     NOR=NUMBER OF RECORD
      NOF=NOF+1
C     EINC=INC.PART.EN.
C     CASESN=NO.OF INC.PART.
C     ANDIT=ANG.DIST.
C     PRTIN=INC.PART.
C     TRSYM=STRUCK PART.
C     RANDI=INPUT RAND NO.
C     IP=TYPE OF REACTION(-1=S.P.,0=D.P.,1=CHOICE)
C     IK=0,STRUCK PART.AT REST--OTHERWISE ASSUME ENERGY
C     JP=0, NO PRINT OUT
      KASE=0
C SENTINEL FOR GETTING CROSS SECTIONS WHEN STRUCK PARTICLE HAS ENERGY
      DO40 I=1,3
   40 CALCIN(I)=0.0
      STRKP = -1.D0
      GOTO(50  ,50  ,60  ,70  ,60  ),NO
   50 PM(1)=DNCMS
      GOTO110
   60 PM(1)=PNMS
      GOTO80
   70 PM(1)=POMS
   80 IF(NO-4)90 ,100,100
   90 ISW(11)=1
      GOTO110
  100 ISW(11)=0
  110 PM(2)=DNCMS
      KA = 1
      E(1)=EINC*RCPMV+PM(1)
      PXYZ(1)=0.0
      PXYZ(5)=0.0
      PXYZ(9) =  DSQRT  (E(1)*E(1) -  PM(1)*PM(1) )
      RLKE=EINC
      IF(IK)140,120,140
  120 P2=0.0
      PXYZ(2)=0.0
      PXYZ(6)=0.0
      PXYZ(10)=0.0
      E(2)=DNCMS
      GOTO140
  130 CONTINUE
  140 IF(NO-3)150,160,160
  150 IF(RLKE-3500.0)230,230,190
  160 IF(RLKE-180.0)190,190,170
  170 IF(RLKE-2500.0)180,180,190
  180 IF(KASE)970 ,230,970
  190 IF(IK)200,210,200
  200 IF(KASE)220,210,220
  210 NE=3
C     RLKE IN CERROR('CISOB1')
      GOTO1050
  220 LOOP=LOOP+1
      IF(LOOP-1000)130,130,210
  230 IF(IP)240,460,460
  240 IF(NO-3)460,370,370
  250 LK=2
      I3=1
  260 CALL QRDET(1,PSPCL(1),CALCIN(1))
C     ARGUMENT=PSPCL, P-P, N-N, S.P.
      CALCIN(1)=CRDT(1)
      IF(LK-6)270,320,320
  270 CALL QRDET(1, PEC(1), RLKE)
C     ELASTIC CROSS SECTION
  280 CALCIN(3)=CRDT(1)+CALCIN(1)+CALCIN(2)
C     TOTAL
C     P-P, N-N, ELASTIC
      GO TO 630
  290 LK=3
      I3=2
  300 CALL QRDET(1, SPCLN(1),CALCIN(1))
C     ARGUMENT=NSPCL, N-P, P-N, S.P.
      CALCIN(1)=CRDT(1)
      IF(LK-6)310,320,320
  310 CALL QRDET(1, ECN(1), RLKE)
      GO TO 280
C     P-N, N-P, ELASTIC
  320 CRATIO=CALCIN(1)/(CALCIN(1)+CALCIN(2))
      VALUE1 = RANDC(ISEED)
      IF(VALUE1-CRATIO)330 ,330 ,350
  330 IF(KA-NO)360 ,340 ,360
  340 I3=1
      GOTO270
  350 IF(KA-NO)310,270,310
  360 I3=2
      GOTO310
  370 ISW(10)=0
      ISW(9)=0
C     9 SET FOR PI0,10 SET FOR PI+-N,PI--P,PI0-P, AND PI0-N
      CALCIN(1)=RLKE-180.0
      LK=1
C     PION
      I3=0
      IF(NO-4)380,420,450
  380 GOTO(390,400),KA
  390 CALL QRDET(1, PPSCL(1),CALCIN(1))
      CALCIN(1)=CRDT(1)
      CALL QRDET(1, PPEC(1),RLKE)
      GOTO280
C     PI(PLUS)-P, S.P. OR PI(MINUS)-N
  400 CALL QRDET(1, PMSCL(1),CALCIN(1))
      CALCIN(1)=CRDT(1)
      CALL QRDET(1, PMEC(1) , RLKE)
  410 CALCIN(3)=CRDT(1)
      ISW(10)=2
      CALL QRDET(1, PMXC(1) , RLKE)
      CALCIN(3)=CALCIN(3)+CRDT(1)+CALCIN(1)+CALCIN(2)
C     PI(PLUS)-N, S.P) OR PI(MINUS)-P
      GOTO630
  420 ISW(9)=2
      GOTO(430,440),KA
  430 CALL QRDET(1, PNSCL(1),CALCIN(1))
      CALCIN(1)=CRDT(1)
      CALL QRDET(1, PNEC(1) ,RLKE)
      GOTO410
C     PI(0)-P, S.P.
  440 CALL QRDET(1,PNNSL(1) ,CALCIN(1))
      CALCIN(1)=CRDT(1)
      CALL QRDET(1,PNNEC(1) ,RLKE )
      GOTO410
C     PI(0)-N, S.P.
  450 GOTO(400,390),KA
C     PI(-)-P, PI(-)-N, S.P.
  460 IF(RLKE-920.0)470,470,530
  470 IF(IP)480,190,480
  480 IF(RLKE-360.0)190,190,490
  490 IF(KASE)970 ,500,970
  500 CALCIN(1)=RLKE-360.0
      GOTO(510,520 ),NO
  510 ISW(4)=1
      GOTO(570,600),KA
  520 ISW(4)=0
      GOTO(600,570),KA
  530 IF(KASE)970 ,540,970
  540 CALCIN(2)=RLKE-920.0
      CALCIN(1)=RLKE-360.0
      GOTO(550,620),NO
  550 ISW(4)=1
      GOTO(560,590),KA
  560 CALL QRDET(1,PDPCL(1) ,CALCIN(2))
C     ARGUMENT=PDPCL, P-P, N-N, D.P.
      CALCIN(2)=CRDT(1)
C     N-N, OR P-P, D.P.
  570 IF(IP)250,580,580
  580 LK=4+2*(IP)
      I3=3
      GOTO260
  590 CALL QRDET(1,DPCLN(1) ,CALCIN(2))
C     ARGUMENT=NDPCL, N-P, P-N, D.P.
      CALCIN(2)=CRDT(1)
  600 IF(IP)290,610,610
  610 LK=5+IP
      I3=4
      GOTO300
C     N-P, OR P-N, D.P.
  620 ISW(4)=0
      GOTO(590,560),KA
  630 IF(JP)1050,650,640
C     JP=0, NO PRINT OUT
  640 WRITE(6,10000)EINC,NO,KA,CASESN,(RANDS(I),I=2,4),(CALCIN(I),I=1,
     +3) , IP,NOF,IK
10000 FORMAT(1H1,'   EINC      NO       KA     CASESN     RANDI      CAL
     +CIN        IP          NOF        IK'/1H0,D11.3,2I8,D11.3,1X,3Z4,
     + 3D11.3,3I8)
  650 CONTINUE
      KASE=1
      IF(IK)130,660,130
  660 GOTO(990 ,990 ,680 ,680 ,680 ),NO
  670 I3=0
  680 CALL QOUT17(FRIPN(1),PNMI(1),FMXSP(1),PCFSL(1),PNFSL(1))
      IF(I3)1090,730 ,690
  690 IF(COL(15)-1.0)730 ,790 ,700
  700 IF(COL(15)-3.0)770 ,760 ,710
  710 IF(COL(15)-5.0)780 ,1020,720
  720 NE=11
      GOTO1050
  730 CALL QOLLM
      IF(PT(38))750 ,740 ,750
  740 I3=1
      GOTO800
  750 I3=2
      GOTO800
  760 I3=4
      GOTO800
  770 I3=5
      GOTO800
  780 I3=6
      GOTO800
  790 I3=3
  800 CALL QOUT18
      I3=I3
      GOTO(690 ,810 ,690 ,820 ),I3
  810 NE=12
      GOTO1050
  820 PM(4)=DNCMS
      K=IP
      J=2
      IF(IP)830 ,860 ,840
  830 NWRIT=22
      MM=26
      GO TO 870
  840 IF(PT(38))850 ,830 ,850
  850 K=K+1
  860 NWRIT=29
      MM=38
  870 OUT(1)=K
      DO900 I=2,MM,12
         M=I
         K=M+3
         DO890 N=1,2
            DO880 L=M,K
               OUT(J)=PT(L)
  880       J=J+1
            M=I+6
  890    K=M+2
  900 CONTINUE
      NOR=NOR+1
  910 IF(JP)1050,930,920
C     JP=0, NO PRINT OUT
  920 WRITE(6,10100)NOR,(OUT(I),I=1,NWRIT),E(2),(PXYZ(I),I=2,10,4)
10100 FORMAT(1H ,I7/(7D14.5))
  930 NWDS=NWRIT+4
C     NO.OF WORDS IN RECORD
  940 DO950 I=1,48
  950 PT(I)=0.0
      PGCNT=0.0
      PACNT=0.0
      LOOP=0
      BEGRU=BEGRU+1.0
      IF(CASESN-BEGRU)1050,1080,960
  960 IF(IK)130,970 ,130
  970 GOTO(670 ,980 ,1000,1010,1040,1100),LK
  980 I3=1
  990 CALL QOUT21(FRINN(1),DMIN(1),FMXSN(1),FMXDN(1),FSLN(1))
      GOTO680
 1000 I3=2
      GOTO990
 1010 I3=3
      GOTO990
 1020 CALL QOUT19
      IF(I3)1030,820 ,820
 1030 NE=13
      GOTO1050
 1040 I3=4
      GOTO990
 1050 CALL CERROR('CISOB$')
      IF(NE-3)1080,1060,1060
 1060 IF(CALCIN(1))1070,1080,1070
 1070 CONTINUE
      NOR=NOR+1
 1080 CONTINUE
      RETURN
 1090 NE=10
      GOTO1050
 1100 VALUE1 = RANDC(ISEED)
      IF(VALUE1-CRATIO)1110,1110,1120
 1110 IF(KA-NO)1000,980 ,1000
 1120 IF(KA-NO)1130,1010,1130
 1130 GO TO 1040
      END
