#cet(3/22/94)try at rsgi01.rhic.bnl.gov
#cet(3/8/94)#BASE_PATH=../13aug93
#whg(2/28/95)removed vxworks and lib stuff
#cet(24/8/95)compile on SunOS 5.4 (sirius) - HACKED!!
#
#CC=gcc
CPPFLAGS= $(patsubst %, -I%, $(HPATH))
#CFLAGS= -Wall
ifeq "$(STAR_ARCH)" "sun4os5"
LDFLAGS= -lnsl -lsocket
endif
ifeq "$(STAR_ARCH)" "sun4os5pc"
LDFLAGS= -lnsl -lsocket
endif
vpath %.c $(SPATH)
vpath %.h $(HPATH)
vpath %.a $(LPATH)
#
LIB=libdsl.a
TESTOBJ=sample.o tcplib.o testjoin.o testlib.o testsort.o testtas.o
TESTLIB=libtestds.a
DSOBJ=testds.o tcptest.o
#DSOBJ=unixtape.o testds.o tcptest.o
DSPROGS=$(basename $(DSOBJ))
OBJ=$(TESTOBJ) $(DSOBJ) $(TCPOBJ)
#
CC68K=cc68k
LD68K=ld68k
CC68FLAGS=-c -DCPU=MC68040 -DVXWORKS -I$(VX_VW_BASE)/h $(CPPFLAGS) -Wall 
VWTEST=dstest.68o
VWOBJ=testlib.68o

all:		dstest

dstest:		$(DSPROGS)

$(DSPROGS):	$(TESTLIB) $(LIB)

test:
	@echo $(SPATH)
	@echo $(HPATH)
	@echo $(LPATH)
	@echo x$(ARCH)x
	@echo x$(SUN5)x
	@echo x$(LDFLAGS)x

vwtest:		$(VWTEST)

%.68o : %.c
		 $(CC68K) $(CC68FLAGS) $< -o $@

$(TESTLIB):	$(TESTOBJ)
		ar r $@ $?
		-ranlib $@

$(OBJ) $(VWOBJ) : dscodes.h dstype.h dsxdr.h sample.h xdrtape.h

$(VWTEST):	$(VWOBJ)
		$(LD68K) -o $(VWTEST) -r $(VWOBJ)

clean:	
		-rm $(TESTLIB) $(OBJ) $(DSPROGS) *.bin *.txt

vwclean:
		-rm $(VWTEST) $(VWOBJ)
