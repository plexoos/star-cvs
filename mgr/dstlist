#!/usr/local/bin/perl
# List all dst xdf files on disk
# T. Wenaus
$topPrefix="/disk00001/star/";
#$topLevel="auau200";
$topLevel = shift(@ARGV) || "auau200";
$theTime = localtime(time());
print "XDF DST files under $topPrefix$topLevel as of $theTime\n";
#open(FILES, "cd $topPrefix; find $topLevel/ | egrep 'dst\.xdf$||evts\.root$' |")
open(FILES, "cd $topPrefix; find $topLevel/ | egrep 'dst\.xdf$' |")
 or die "Failed on xdf seek\n";
$totalsize = 0;
$nfiles = 0;
$nnew = 0;
while (<FILES>) {
  $fullpath = $_;
  @tokens = split(/\//);
  $totalsize += $tokens[4];
  $nfiles++;
  $fname = $tokens[$#tokens];
  $thepath = $topPrefix.$fullpath;
  $thepath =~ s/$fname//;
  chomp($fname);
  $dbname = "/star/sol/db/stardb/dst/$fname.STAR.DB";
  chomp($fullpath);
  print $topPrefix.$fullpath;
  if ( -e $dbname ) {
    print " in DB";
  } else {
    $nnew++;
  }
  print "\n";
}

open(FILES, "cd $topPrefix; find $topLevel/ | egrep 'evts\.root$' |")
 or die "Failed on root seek\n";
$totalsize = 0;
$nrootfiles = 0;
$nrootnew = 0;
while (<FILES>) {
  $fullpath = $_;
  @tokens = split(/\//);
  $totalsize += $tokens[4];
  $nrootfiles++;
  $fname = $tokens[$#tokens];
  $thepath = $topPrefix.$fullpath;
  $thepath =~ s/$fname//;
  chomp($fname);
  $dbname = "/star/sol/db/stardb/dst/$fname.STAR.DB";
  chomp($fullpath);
  print $topPrefix.$fullpath;
  if ( -e $dbname ) {
    print " in DB";
  } else {
    $nrootnew++;
  }
  print "\n";
}
print "Total of ",$nfiles," XDF files under $topPrefix$topLevel, ",$nnew," of them new and not in DB\n";
print "Total of ",$nrootfiles," ROOT files under $topPrefix$topLevel, ",$nrootnew," of them new and not in DB\n";
