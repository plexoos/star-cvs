#!/usr/local/bin/perl
# List all dst xdf files on disk
# T. Wenaus
$topPrefix="/disk1/star/";
#$topLevel="auau200";
#$topLevel="tfs_dst";
$topLevel = shift(@ARGV) || "auau200";
open(SCRIPT,"> newdst2db.kumac");
$theTime = localtime(time());
print "XDF DST files under $topPrefix$topLevel as of $theTime\n";
open(FILES, "cd $topPrefix; find $topLevel/ | grep 'dst\.xdf' |")
 or die "Failed on xdf seek\n";
$totalsize = 0;
$nfiles = 0;
$nnew = 0;
while (<FILES>) {
  $fullpath = $_;
  @tokens = split(/\//);
  $totalsize += $tokens[4];
  $nfiles++;
  $fname = $tokens[$#tokens];
  $thepath = $topPrefix.$fullpath;
  $thepath =~ s/$fname//;
  chomp($fname);
  $dbname = "/star/sol/db/stardb/dst/$fname.STAR.DB";
  chomp($fullpath);
  print $topPrefix.$fullpath;
  if ( -e $dbname ) {
    print " in DB";
  } else {
    $nnew++;
    print " not in DB";
  }
  print "\n";
}
print "Total of ",$nfiles," files under $topLevel, ",$nnew," of them new and not in DB\n";
