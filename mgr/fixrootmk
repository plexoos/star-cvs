#!/usr/bin/env perl

#
# This shift/noshit selection is always a mess ...
# Get around by fixing ROOT make file.
# (c) J. Lauret 2003
# 
#

$CERNL = $ENV{CERN_LEVEL};

if ( ! defined($CERNL) ){
    die "No CERN_LEVEL defined. Cannot proceed.\n";
}

if ( ! -e "config/Makefile.config"){
    die "You are probably not in the proper directory\n";
}

if ( ! -e "/cern/$CERNL/lib/libpacklib_noshift.a"){
    die "/cern/$CERNL/lib/libpacklib_noshift.a does not exist. Would not know what to do...\n";
}


open(FI, "config/Makefile.config");
open(FO,">config/Makefile.config.new");

$done = 0;

while ( defined($line = <FI>) ){
    chomp($line);
    if ($line =~ m/CERNLIBS\s+:=\s*$/){
	print FO "CERNLIBS := /cern/$CERNL/lib/libpacklib_noshift.a /cern/$CERNL/lib/libkernlib.a\n";
	print    "CERNLIBS := /cern/$CERNL/lib/libpacklib_noshift.a /cern/$CERNL/lib/libkernlib.a\n";
	$done = 1;
    } elsif ( $line =~ m/BUILDHBOOK/){
	# Introduced at ROOT 4.04.02
	print FO "BUILDHBOOK := yes\n";
    } else {
	print FO "$line\n";
    }
}
close(FI);
close(FO);



if ($done){
    rename("config/Makefile.config",    "config/Makefile.config.old");
    rename("config/Makefile.config.new","config/Makefile.config");

    print "config/Makefile.config fixed\n";
} else {
    print "config/Makefile.config already fixed\n";
    unlink("config/Makefile.config.new");
}

