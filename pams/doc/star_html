#!/bin/csh
# Revision 1.2  1998/04/20 21:46:11  fisyak
# Module description
#
# Revision 1.1  1998/04/19 21:00:35  fisyak
# Add cross reference module documentation
#
echo "<HTML>"
echo "<HEAD>"
echo "<TITLE>List of STAR modules and tables</TITLE>"
echo "</HEAD>"
echo "<BODY>"
echo "<H2>List of STAR pams</H2>"
echo "<hr>"
echo "<h3>Domains</h3>"
  set all_dom = `ls ${STAR}/pams | sed -e 's/CVS//g' -e 's/doc//g' -e 's/params//g'`
  foreach dom ($all_dom)
     echo '<a href="#'$dom'">'$dom'</a> &nbsp;'
  end
echo '<hr>'
# list of all modules
 foreach domain ($all_dom)
   set dom_idl = `find $STAR/pams/$domain -name "*.idl"`
   set dom_idm = `egrep -l 'interface' $dom_idl`
   set dom_idt = `egrep -l 'struct '   $dom_idl`
   echo '<H3>Domain '$domain
   set count = 0
   set DOC = $STAR/pams/$domain/doc
   if (-r $DOC) then
     set hid = `echo $DOC | sed -e 's/\/afs\/rhic\/star\/packages\//http:\/\/www.rhic.bnl.gov\/afs\/rhic\/star\/doc\/www\/packages_l\//'`
     echo ' with <a href="'$hid'">documentation</a>'
   endif
   echo '</h3>'
   set README = $STAR/pams/$domain/README 
   if (-r $README) then
     echo "<pre>"
     cat  $README | sed -e '/^$/d'
     echo '</pre>'
   endif
#list of all tables in domain
   echo "<h4>Domain's tables</h4>"
   foreach idl ($dom_idt)
      set id = `basename $idl .idl`
      echo '<a href="#'$id'_tab"><strong>'$id'</strong></a>'
   end
   set package = ""
   foreach idlm ($dom_idm) 
     set dir = `dirname $idlm`
     if ($package == "") echo "<h4>Domain's packages<h4>"
     if ($dir != $package) then 
       if (-r $dir/README) then
         echo '<pre>'
         cat  $dir/README | sed -e '/^$/d'
         echo '</pre>'
       endif
       if (-r $dir/doc) then
        set hid = `echo $dir/doc | sed -e 's/\/afs\/rhic\/star\/packages\//http:\/\/www.rhic.bnl.gov\/afs\/rhic\/star\/doc\/www\/packages_l\//'`
        echo '<a href="'$hid'">Documentation</a> for '
       endif
#      echo '<br>'
#     else
#       echo '<br>'
#       echo 'Package '$dir':'
     endif
     set package = $dir
     set id = `basename $idlm .idl`
     echo '<a href="#'$id'_mod"><strong>'$id'</strong></a>&nbsp;'
   end
 end
echo "<hr>"
echo "<H2>List of STAR tables</H2>"
echo "<hr>"
echo "<hr>"
set count = 0
set domain = ""
set all_idl = `find $STAR/pams -name "*.idl"`
set all_idm = `egrep -l 'interface' $all_idl`
set all_idt = `egrep -l 'struct '   $all_idl`
 foreach idl ($all_idt) 
   set dom = `echo $idl | gawk -F / '{for (i=1;i<=NF;i++) {if(index($i,"pams")>0) {l=i+1; print $l;break;}}};'`
   if ($dom != $domain) then
      set domain = $dom;
      echo '<H3><a name="'$domain'">Domain '$domain'</a></H3>'
      echo "<hr>"
      set count = 0
   endif

   set id = `basename $idl .idl`
   echo '<a href="#'$id'_tab"><strong>'$id'</strong></a> &nbsp; &nbsp; &nbsp;'
   set count = `expr $count + 1`;
#   if ($count >= 5) then
#       echo "<br>"
#       set count = 0;
#   endif
 end
echo "<H2>List of STAR pams</H2>"
echo "<hr>"
echo "<ol>"
 foreach idl ($all_idm) 
   set id = `basename $idl .idl`
   set hid = `echo $idl | sed -e 's/\/afs\/rhic\/star\/packages\//http:\/\/www.rhic.bnl.gov\/afs\/rhic\/star\/doc\/www\/packages_l\//'`
   echo '<li>Module <a name="'$id'_mod"><strong>'$id'</strong></a> defined in <a href="'$hid'">'$idl'</a>'
echo '<BR>'
echo '<TABLE CELLPADDING=3 BORDER="1">'
echo '<TR><TD>Module</TD><TD>Input tables</TD><TD>Output tables</TD></TR>'
   ./module_html   $idl
echo '</TABLE>'                                                                                                 
 end
echo "</ol>"
echo "<hr>"
echo "<H2>List of STAR tables</H2>"
echo "<hr>"
echo "<ol>"
 foreach idl ($all_idt) 
   set id = `basename $idl .idl`
   set hid = `echo $idl | sed -e 's/\/afs\/rhic\/star\/packages\//http:\/\/www.rhic.bnl.gov\/afs\/rhic\/star\/doc\/www\/packages_l\//'`
   echo '<li> Table <a name="'$id'_tab"><strong>'$id'</strong></a> is defined in <a href="'$hid'">'$idl'</a> and used by the following modules:'
   set idlm_idl = `egrep -l ${id}.idl $all_idm`
   foreach idlm ($idlm_idl)
     set did = `basename $idlm .idl`
     echo '<a href="#'$did'_mod">'$did'</a> &nbsp;&nbsp;&nbsp;&nbsp;'
   end
 end
echo "</ol>"
echo "<hr>"
echo "</BODY>"
echo "</HTML>"
