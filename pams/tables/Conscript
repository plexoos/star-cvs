#!/opt/star/bin/perl 
Import qw ( env INCLUDE LIB BIN EXPORT BUILD OBJ);
(my $build = $OBJ) =~ s/\#//g;
$build =~ s/\\/\//g;# print "OBJ = $OBJ build = $build MAIN = $MAIN\n";
my $DirPath = DirPath '.'; #print "DirPath = $DirPath\n"; 
(my $ObjDir = $DirPath) =~ s/\\/\//g; #print "ObjDir = $ObjDir\n";
(my $Dir = $ObjDir) =~ s/$build\///g; #print "Dir = $Dir\n";
my $STAR_SYS = $env->{ENV}->{STAR_SYS};
my @pkgs = qw(StDb      ebye      gen       l3        svt       vpd
	      emc       geometry  mwc       tpc       ctf       ftpc
	      global    sim       trg);
my $LIBPATH = $env->{LIBPATH};# print "LIBPATH = $LIBPATH\n";
my $LIBS  = $env->{LIBS};
my @Repo = Repository_List unless $param::noRepository; #print "Repositories = |@Repo|\n";
my @Deps = ();
(my $llib = $LIB) =~ s/\#//; #print "llib = $llib\n";
my $pwd = cwd(); #print "pwd = $pwd\n";
foreach my $pkg (@pkgs) {
#  if ($STAR_SYS =~ /^hp_ux102$/) {
#    my $lib = $llib  . $pkg . "_Tables.so"; print "lib = $lib\n";
#    $LIBS .= " " . $lib;
##    my $lib = "../../" . $llib  . $pkg . "_Tables.so"; print "lib = $lib\n";
##    if (-f $lib) {$LIBS .= " " . $lib;}
##    else {
##      foreach my $dir (@Repo) {
##	my $rlib = $dir . "/" . $lib; print "rlib = $rlib\n";
##	if (-f $rlib) {$LIBS .= " " . $rlib; last;}
##      }
##    }
#  }
#  else  {
    my $lib = "-l" . $pkg . "_Tables"; $LIBS .= " " . $lib;
#  }
  $lib = $LIB . "/lib" . $pkg . "_Tables." . $env->{SUFSOLIB};			 
  push @Deps, $lib;
} #print "LIBS = $LIBS\n";
$env3 = $env->clone(
		    'DEBUG'      => ' ',
		    'LIBS'       => $LIBS
		     );
my $PKG = "St_Tables";
my $SO_PKG = $PKG . "." . $env->{SUFSOLIB};#print "SO_PKG = $SO_PKG\n";
my $LIBPKG = $PKG . "." . $env->{SUFLIB};
printf ("Run Conscript          in %-30s  for %-20s\n",$Dir, $PKG) unless ($param::quiet);
Depends $env3 $SO_PKG, @Deps;
LinkedModule $env3 $SO_PKG;
Install $env3 $LIB, $SO_PKG;
#
