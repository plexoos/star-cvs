 macro make_param TOP=$STAR domain='emc'
   shell rm ./params/emc/ems_param.xdf ./params/emc/jet_param.xdf ./params/emc/cal_param.xdf 
   macro/global/create TOP [TOP]
   macro/global/create gstar_settings [gstar_settings]
   exec $STAR/kumacs/util/setup_defaults
   exec setup#setup
   alias/create STAFCV_OK  1
   alias/create STAFCV_BAD 0   
   macro/global/import *
   exec load_libraries#run [domain]
   
   cd [params]/emc
   mkdir ems
   mkdir cal
   mkdir jet
   cd /dui
   
   exec init_ems.kumac#write
   exec init_cal.kumac#write
   exec init_jet.kumac#write

**   
** Save parameters 
**
   dio/newfilestream out1 ./params/emc/ems_param.xdf w
   dio/stream/putevent out1 [params]/emc/ems
   dio/stream/close out1
   dio/newfilestream out2 ./params/emc/jet_param.xdf w
   dio/stream/putevent out2 [params]/emc/jet
   dio/stream/close out2
   dio/newfilestream out3 ./params/emc/cal_param.xdf w
   dio/stream/putevent out3 [params]/emc/cal
   dio/stream/close out3
      
   exec fake_pedestal
   exec fake_adcslope

return   

*** Make fake pedestal calibration constants   
macro fake_pedestal 
  macro/global/import *
  cd [params]/emc/cal
 
  tdm/table/cell/putvalue 'ems_cal_control[0].det'                1
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_channel'        0
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_var'            0
  tdm/newtable org_ped_bemc_h emc_calib_header 1
  tdm/newtable org_ped_bemc   emc_pedestal     4800
  ami/module/call fake_pedestal [params]/emc/ems/ems_control ems_cal_control _
    org_ped_bemc_h org_ped_bemc 

  tdm/table/cell/putvalue 'ems_cal_control[0].det'                2
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_channel'        0
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_var'            0
  tdm/newtable org_ped_bprs_h emc_calib_header 1
  tdm/newtable org_ped_bprs   emc_pedestal     4800
  ami/module/call fake_pedestal [params]/emc/ems/ems_control ems_cal_control _
    org_ped_bprs_h org_ped_bprs
  
  tdm/table/cell/putvalue 'ems_cal_control[0].det'                3
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_channel'        0
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_var'            0
  tdm/newtable org_ped_bsmde_h emc_calib_header 1
  tdm/newtable org_ped_bsmde   emc_pedestal     18000
  ami/module/call fake_pedestal [params]/emc/ems/ems_control ems_cal_control _
    org_ped_bsmde_h org_ped_bsmde 

  tdm/table/cell/putvalue 'ems_cal_control[0].det'                4
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_channel'        0
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_var'            0
  tdm/newtable org_ped_bsmdp_h emc_calib_header 1
  tdm/newtable org_ped_bsmdp   emc_pedestal     18000
  ami/module/call fake_pedestal [params]/emc/ems/ems_control ems_cal_control _
    org_ped_bsmdp_h org_ped_bsmdp 

  tdm/table/cell/putvalue 'ems_cal_control[0].det'                5
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_channel'        0
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_var'            0
  tdm/newtable org_ped_eemc_h emc_calib_header 1
  tdm/newtable org_ped_eemc   emc_pedestal     1440
  ami/module/call fake_pedestal [params]/emc/ems/ems_control ems_cal_control _
    org_ped_eemc_h org_ped_eemc 

  tdm/table/cell/putvalue 'ems_cal_control[0].det'                6
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_channel'        0
  tdm/table/cell/putvalue 'ems_cal_control[0].ped_var'            0
  tdm/newtable org_ped_eprs_h emc_calib_header 1
  tdm/newtable org_ped_eprs   emc_pedestal     1440
  ami/module/call fake_pedestal [params]/emc/ems/ems_control ems_cal_control _
    org_ped_eprs_h org_ped_eprs
  
  cd /dui
return

*** Make fake adc slope calibration constants   
macro fake_adcslope 
  macro/global/import *
  cd [params]/emc/cal

  tdm/table/cell/putvalue 'ems_cal_control[0].det'	          1
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_fun'          1
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_ave'          1.0
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_var'          0.0
  tdm/newtable org_slp_bemc_h emc_calib_header 1
  tdm/newtable org_slp_bemc   emc_adcslope     4800
  ami/module/call fake_adcslope [params]/emc/ems/ems_control ems_cal_control _
    org_slp_bemc_h org_slp_bemc
  
  tdm/table/cell/putvalue 'ems_cal_control[0].det'	          2
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_fun'          1
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_ave'          1.0
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_var'          0.0
  tdm/newtable org_slp_bprs_h emc_calib_header 1
  tdm/newtable org_slp_bprs   emc_adcslope     4800
  ami/module/call fake_adcslope [params]/emc/ems/ems_control ems_cal_control _
    org_slp_bprs_h org_slp_bprs
  
  tdm/table/cell/putvalue 'ems_cal_control[0].det'	          3
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_fun'          1
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_ave'          1.0
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_var'          0.0
  tdm/newtable org_slp_bsmde_h emc_calib_header 1
  tdm/newtable org_slp_bsmde   emc_adcslope     18000
  ami/module/call fake_adcslope [params]/emc/ems/ems_control ems_cal_control _
    org_slp_bsmde_h org_slp_bsmde
  
  tdm/table/cell/putvalue 'ems_cal_control[0].det'	          4
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_fun'          1
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_ave'          1.0
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_var'          0.0
  tdm/newtable org_slp_bsmdp_h emc_calib_header 1
  tdm/newtable org_slp_bsmdp   emc_adcslope     18000
  ami/module/call fake_adcslope [params]/emc/ems/ems_control ems_cal_control _
    org_slp_bsmdp_h org_slp_bsmdp

  tdm/table/cell/putvalue 'ems_cal_control[0].det'	          5
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_fun'          1
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_ave'          1.0
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_var'          0.0
  tdm/newtable org_slp_eemc_h emc_calib_header 1
  tdm/newtable org_slp_eemc   emc_adcslope     1440
  ami/module/call fake_adcslope [params]/emc/ems/ems_control ems_cal_control _
    org_slp_eemc_h org_slp_eemc
  
  tdm/table/cell/putvalue 'ems_cal_control[0].det'	          6
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_fun'          1
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_ave'          1.0
  tdm/table/cell/putvalue 'ems_cal_control[0].slope_var'          0.0
  tdm/newtable org_slp_eprs_h emc_calib_header 1
  tdm/newtable org_slp_eprs   emc_adcslope     1440
  ami/module/call fake_adcslope [params]/emc/ems/ems_control ems_cal_control _
    org_slp_eprs_h org_slp_eprs

  cd /dui
return





