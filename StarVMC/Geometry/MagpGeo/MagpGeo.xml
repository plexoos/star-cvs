<Document cmdline="{'path_name': './', 'module_name': None, 'language': 'AgML', 'filename': 'pams/geometry/magpgeo/magpgeo.g'}" file="pams/geometry/magpgeo/magpgeo.g"  >
    <Module name="MAGPGEO" comment=" is the geometry of the STAR magnet "  >
        <CDE  >
            AGECOM
            GCUNIT
        </CDE>
        
        <Author name="Pavel Nevski"  />
        <Created date="   19 March 1996 "  />

        <Content  >
            MAGP,COIL,MTCL,MPTV,MPCV,MRET,MRGV,MSEC,MBAR,MCSE
        </Content>
        

        <Structure name="MAGG"  >
            <var name="version" type="float"  />
            <var name="Rmax" type="float"  />
            <var name="Length" type="float"  />
            <var name="test" type="float"  />
        </Structure>
        

        <Structure name="MBAR"  >
            <var name="CoilRmn" type="float"  />
            <var name="CoilRmx" type="float"  />
            <var name="CoilLen" type="float"  />
            <var name="RetYRmn" type="float"  />
            <var name="RetYLen" type="float"  />
            <var name="BarWidin" type="float"  />
            <var name="BarWidou" type="float"  />
            <var name="BarHeigh" type="float"  />
            <var name="RingRmn" type="float"  />
            <var name="Ncoil" type="float"  />
            <var name="zcoil(6)" type="float"  />
            <var name="dzcoil(6)" type="float"  />
        </Structure>
        

        <Structure name="MEND"  >
            <var name="PoleRmn" type="float"  />
            <var name="poleZ" type="float"  />
            <var name="PoleRmx" type="float"  />
            <var name="tcoilRmn" type="float"  />
            <var name="tcoilRmx" type="float"  />
            <var name="PoleCavR" type="float"  />
            <var name="PoleCavD" type="float"  />
            <var name="tcoilDZ" type="float"  />
            <var name="etacut" type="float"  />
        </Structure>
        

        <varlist type="REAL"  >
            TanTheta,Rcorner,Zcut,d
        </varlist>
        
        <varlist type="INTEGER"  >
            I_coil
        </varlist>
        
        <Fill name="MAGG" comment="Magnet basic dimensions"  >
            <var name="version" value="1" comment=" version number "  />
            <var name="Rmax" value="364.29" comment=" outer radius of the magnet system "  />
            <var name="Length" value="715.00" comment=" magnet system full length "  />
            <var name="test" value="0" comment=" geometry type: 0-standard, 1-test "  />
        </Fill>
        
        <Fill name="MBAR" comment="Barrel Part"  >
            <var name="CoilRmn" value="264.90" comment=" barrel coil inner radius (barrel minimum) "  />
            <var name="CoilRmx" value="299.30" comment=" barrel coil outer radius "  />
            <var name="CoilLen" value="627.40" comment=" barrel coil full length "  />
            <var name="RetYRmn" value="303.29" comment=" Return Yoke minimum radius "  />
            <var name="RetYLen" value="684.40" comment=" Return Yoke full length "  />
            <var name="BarWidin" value="44.34" comment=" return yoke bare inner width "  />
            <var name="BarWidou" value="57.15" comment=" return yoke bare outer width "  />
            <var name="BarHeigh" value="60.00" comment=" return yoke bare height "  />
            <var name="RingRmn" value="263.68" comment=" Return Ring minimum radius "  />
            <var name="Ncoil" value="12" comment=" total number of barrel coils "  />
            <var name="Zcoil" value="{30.95,89.05,147.17,205.25,249.0,288.35}" comment=" coil position "  />
            <var name="dZcoil" value="{45.24,45.24,45.24,45.24,22.71,45.24}" comment=" coil width   "  />
        </Fill>
        
        <Fill name="MEND" comment="EndCap Part"  >
            <var name="PoleZ" value="310.007" comment=" pole tip nominal position "  />
            <var name="PoleRmn" value="90.028" comment=" Pole tip inner radius (encap minimum) "  />
            <var name="PoleRmx" value="252.882" comment=" Pole tip outer radius "  />
            <var name="PoleCavR" value="152.4" comment=" Pole tip cavity outer radius "  />
            <var name="PoleCavD" value="18" comment=" Pole tip cavity depth "  />
            <var name="tcoilRmn" value="91.34" comment=" Pole tip trim coil inner radius "  />
            <var name="tcoilRmx" value="141.28" comment=" Pole tip trim coil outer radius "  />
            <var name="tcoilDZ" value="16.5" comment=" full width of Pole Tip trim Coil "  />
            <var name="etacut" value="2" comment=" eta limits for the Pole  "  />
        </Fill>
        
        <Use struct="MAGG" select="version" value="1  "  />
        <Use struct="MBAR"  />
        <Use struct="MEND"  />
        TanTheta = (exp(+mend_etacut)-exp(-mend_etacut))/2 

        <Create block="MAGP"  />
        <Placement block="MAGP" in="Cave"  >
        </Placement>
        

        <Block name="MAGP" comment="is the magnet mother"  >
            <Material name="Air"  />
            <Medium name="Standard"  />
            <Attribute for="MAGP" seen="0" colo="1"  />
            <If expr="magg_test==1"  >
                <Shape type="TUBE" rmax="magg_Rmax" rmin="mend_PoleRmn" dz="magg_Length/2"  />
                <Else  >
                    <Shape type="PCON" zi="{-magg_Length/2,-mend_PoleZ,-mend_PoleZ,mend_PoleZ,mend_PoleZ,magg_Length/2}" rmn="{mend_PoleRmn,mend_PoleRmn,mbar_CoilRmn,mbar_CoilRmn,mend_PoleRmn,mend_PoleRmn}" rmx="{magg_Rmax,magg_Rmax,magg_Rmax,magg_Rmax,magg_Rmax,magg_Rmax}" nz="6" phi1="0" dphi="360"  />
                </Else>
                
            </If>
            
            <Create block="COIL"  />
            <Placement block="COIL"  >
            </Placement>
            
            <Create block="MRET"  />
            <Placement block="MRET"  >
            </Placement>
            
            <Create block="MPTV"  />
            <Placement z="+mend_PoleZ" block="MPTV"  >
            </Placement>
            
            <Placement z="-mend_PoleZ" block="MPTV"  >
                <Rotation thetaz="180"  />
            </Placement>
            
            <Create block="MRGV"  />
            <Placement z="+mbar_coilLen/2" block="MRGV"  >
            </Placement>
            
            <Placement z="-mbar_coilLen/2" block="MRGV"  >
                <Rotation thetaz="180"  />
            </Placement>
            
        </Block>
        
        <Block name="COIL" comment="is the main coil mother"  >
            <Attribute for="COIL" seen="0" colo="2"  />
            <Shape type="TUBE" rmax="mbar_coilRmx" rmin="mbar_coilRmn" dz="mbar_coilLen/2"  />
            <Do var="I_coil" from="1" to="nint(mbar_Ncoil/2)"  >
                <Create block="MCSE"  />
                <Placement z="+mbar_Zcoil(I_coil)" block="MCSE"  >
                </Placement>
                
                <Placement z="-mbar_Zcoil(I_coil)" block="MCSE"  >
                </Placement>
                
            </Do>
            
        </Block>
        
        <Block name="MCSE" comment="is a single barrel coil"  >
            <Material name="Aluminium"  />
            <Attribute for="MCSE" seen="1" colo="3"  />
            <Shape type="TUBE" dz="mbar_DzCoil(I_coil)/2"  />
        </Block>
        
        <Block name="MRET" comment="is Magnet RETurn Yoke"  >
            <Attribute for="MRET" seen="0" colo="3"  />
            <Shape type="TUBE" rmax="magg_Rmax" rmin="mbar_RetYRmn" dz="mbar_RetYLen/2"  />
            <Create block="MSEC"  />
        </Block>
        
        <Block name="MSEC" comment="is a sector containing a single retun bar"  >
            <Shape type="DIVISION" ndiv="30" iaxis="2"  />
            <Create block="MBAR"  />
            <Placement x="mbar_RetYRmn+60.0/2" block="MBAR"  >
                <Rotation ort="YZX"  />
            </Placement>
            
        </Block>
        
        <Block name="MBAR" comment="is a single return yoke bar"  >
            <Material name="Iron"  />
            <Attribute for="MBAR" seen="1" colo="3"  />
            <Shape type="TRD1" dz="mbar_BarHeigh/2" dx2="mbar_BarWidou/2" dx1="mbar_BarWidin/2" dy="mbar_RetYLen/2"  />
        </Block>
        
        <Block name="MRGV" comment="is the Magnet Return rinG"  >
            D = (mbar_RetYLen-mbar_coilLen)/2 
            <Material name="Iron"  />
            <Attribute for="MRGV" seen="1" colo="6"  />
            <Shape type="PCON" zi="{0,D,D,(magg_Length-mbar_coilLen)/2}" rmn="{mbar_RingRmn,mbar_RingRmn,mbar_RingRmn,mbar_RingRmn}" rmx="{mbar_RetYRmn,mbar_RetYRmn,magg_Rmax,magg_Rmax}" nz="4" phi1="0" dphi="360"  />
        </Block>
        
        <Block name="MPTV" comment="is the magnet pole-tip volume"  >
            Zcut     = mend_tcoilRmn*TanTheta-mend_PoleZ 
            Rcorner  = magg_Length/TanTheta/2 
            <Material name="Iron"  />
            <Attribute for="MPTV" seen="1" colo="6"  />
            <Shape type="PCON" zi="{0,Zcut,magg_Length/2-mend_PoleZ}" rmn="{mend_TcoilRmn,mend_TcoilRmn,Rcorner}" rmx="{mend_PoleRmx,mend_PoleRmx,mend_PoleRmx}" nz="3" phi1="0" dphi="360"  />
            <Create block="MPCV"  />
            <Placement z="+mend_PoleCavD/2" block="MPCV"  >
            </Placement>
            
        </Block>
        
        <Block name="MPCV" comment="is the coil cavity in the pole-tip (filled with cables ?)"  >
            <Material name="Aluminium"  />
            <Attribute for="MPCV" seen="1" colo="7"  />
            <Shape type="TUBE" rmax="mend_PoleCavR" rmin="mend_tcoilRmn" dz="mend_PoleCavD/2"  />
            <Create block="MTCL"  />
            <Placement z="+mend_tcoilDZ/2-mend_PoleCavD/2" block="MTCL"  >
            </Placement>
            
        </Block>
        
        <Block name="MTCL" comment="is TRIM COIL Volume (filled with aluminum)"  >
            <Material name="Aluminium"  />
            <Attribute for="MTCL" seen="1" colo="3"  />
            <Shape type="TUBE" rmax="mend_tcoilRmx" rmin="mend_tcoilRmn" dz="mend_tcoilDZ/2"  />
        </Block>
        
    </Module>
    



</Document>

