<Document  file="StarVMC/Geometry/BbcmGeo/BbcmGeo.xml">

    <Module name="BBCMGEO" comment=" is the Beam Beam Counter Modules GEOmetry "  >
        <Created date="   15 march 2002 "  />
        <Author name="Yiqun Wang"  />
        <CDE  >
            AGECOM
            GCONST
            GCUNIT
        </CDE>
        
        <Content  >
            BBCM,BBCA,THXM,SHXT,BPOL,CLAD 
        </Content>
        
        <Structure name="BBCG"  >
            <var name="version" type="float"  />
            <var name="onoff(3)" type="float"  />
            <var name="zdis(2)" type="float"  />
        </Structure>
        
        <Structure name="HEXG"  >
            <var name="type" type="float"  />
            <var name="irad" type="float"  />
            <var name="clad" type="float"  />
            <var name="thick" type="float"  />
            <var name="zoffset" type="float"  />
            <var name="xoffset" type="float"  />
            <var name="yoffset" type="float"  />
        </Structure>
        
        <varlist type="REAL"  >
            actr,srad,lrad,ztotal,x0,y0,theta0,phi0,xtrip,ytrip,rtrip,thetrip,rsing,thesing
        </varlist>
        
        <varlist type="INTEGER"  >
            I_trip,J_sing
        </varlist>
        
        <Fill name="BBCG" comment="BBC geometry"  >
            <var name="Version" value="1.0" comment=" Geometry version "  />
            <var name="Onoff" value="{3,3,3}" comment=" 0 off, 1 west on, 2 east on, 3 both on: for BBC,Small tiles,Large tiles "  />
            <var name="zdis" value="{374.24,-374.24}" comment=" z-coord from center in STAR (715/2+6*2.54+1=373.8) "  />
        </Fill>
        

        <Fill name="HEXG" comment="hexagon tile geometry"  >
            <var name="Type" value="1" comment=" 1 for small hex tile, 2 for large tile "  />
            <var name="irad" value="4.174" comment=" inscribing circle radius =9.64/2*sin(60)=4.174 "  />
            <var name="clad" value="0.1" comment=" cladding thickness "  />
            <var name="thick" value="1.0" comment=" thickness of tile "  />
            <var name="zoffset" value="1.5" comment=" z-offset from center of BBCW (1), or BBCE (2) "  />
            <var name="xoffset" value="0.0" comment=" x-offset center from beam for BBCW (1), or BBCE (2) "  />
            <var name="yoffset" value="0.0" comment=" y-offset center from beam for BBCW (1), or BBCE (2) "  />
        </Fill>
        
        <Fill name="HEXG" comment="hexagon tile geometry"  >
            <var name="Type" value="2" comment=" 1 for small hex tile, 2 for large tile "  />
            <var name="irad" value="16.697" comment=" inscribing circle radius (4x that of small one) "  />
            <var name="clad" value="0.1" comment=" cladding of tile "  />
            <var name="thick" value="1.0" comment=" thickness of tile "  />
            <var name="zoffset" value="-1.5" comment=" z-offset from center of BBCW (1), or BBCE (2) "  />
            <var name="xoffset" value="0.0" comment=" x-offset center from beam for BBCW (1), or BBCE (2) "  />
            <var name="yoffset" value="0.0" comment=" y-offset center from beam for BBCW (1), or BBCE (2) "  />
        </Fill>
        
        <Use struct="BBCG"  />
        <Print level="1" fmt="'BBCMGEO version ', F4.2"  >
            bbcg_version  
        </Print>
        

        <!-- small kludge x10000 because ROOT will cast these to (int) before computing properties -->
        <Mixture name="ALKAP" dens="1.432"  >
            <Component name="C5" a="12" z="6"  w="5*10000"  />
            <Component name="H4" a="1"  z="1"  w="4*10000"  />
            <Component name="O2" a="16" z="8"  w="2*10000"  />
            <Component name="Al" a="27" z="13" w="0.2302*10000"  />
        </Mixture>

        

        <Use struct="HEXG" select="type" value="1 "  />
        srad = hexg_irad*6.0 
        ztotal = hexg_thick+2*abs(hexg_zoffset) 

        <Use struct="HEXG" select="type" value="2 "  />
        lrad = hexg_irad*6.0 
        ztotal = ztotal+hexg_thick+2*abs(hexg_zoffset)  ! hexg_zoffset is negative for Large (type=2) 

        <Create block="BBCM"  />
        <If expr="bbcg_OnOff(1)==1|bbcg_OnOff(1)==3"  >
            <Placement y="0" x="0" z="bbcg_zdis(1)" block="BBCM" in="CAVE"  >
            </Placement>
            

        </If>
        
        <If expr="bbcg_OnOff(1)==2|bbcg_OnOff(1)==3"  >
            <Placement y="0" x="0" z="bbcg_zdis(2)" block="BBCM" in="CAVE"  >
                <Rotation alphay="180"  />
            </Placement>            
        </If>
        

        <Print level="1" fmt="'BBCMGEO finished'"  >
        </Print>
        
        <Block name="BBCM" comment="is one BBC East or West module"  >
            <Material name="Air" />
            <Medium name="standard"  />
            <Attribute for="BBCM" seen="0" colo="7"  />
            <Shape type="tube" dz="ztotal/2" rmin="0" rmax="lrad"  />

            <Use struct="HEXG" select="type" value="1 "  />
            <If expr="bbcg_OnOff(2)==1|bbcg_OnOff(2)==3"  >
                <Create block="BBCA"  />
                <Placement y="hexg_yoffset" x="hexg_xoffset" z="hexg_zoffset" block="BBCA" in="BBCM"  >
                </Placement>
                
            </If>
            
            <Use struct="HEXG" select="type" value="2 "  />
            <If expr="bbcg_OnOff(3)==1|bbcg_OnOff(3)==3"  >
                <Create block="BBCA"  />
                <Placement y="hexg_yoffset" x="hexg_xoffset" z="hexg_zoffset" block="BBCA" in="BBCM"  >
                </Placement>
                
            </If>
            
        </Block>
        
        <Block name="BBCA" comment="is one BBC Annulus module"  >
            <Material name="Air"  />
            <Medium name="standard"  />
            <Attribute for="BBCA" seen="0" colo="3"  />
            <Shape type="tube" dz="hexg_thick/2" rmin="hexg_irad" rmax="hexg_irad*6.0"  />

            x0=hexg_irad*tan(pi/6.0) 
            y0=hexg_irad*3.0 
            rtrip = sqrt(x0*x0+y0*y0) 
            theta0 = atan(y0/x0) 

            <Do var="I_trip" from="0" to="5"  >

                phi0 = I_trip*60 
                thetrip = theta0+I_trip*pi/3.0 
                xtrip = rtrip*cos(thetrip) 
                ytrip = rtrip*sin(thetrip) 

                <Create block="THXM"  />
                <Placement in="BBCA" y="ytrip" x="xtrip" z="0" konly="'MANY'" block="THXM"  >
                    <Rotation thetaz="0" thetax="90" phiz="0" phiy="90+phi0" phix="phi0"  />
                </Placement>
                

            </Do>
            

        </Block>
        
        <Block name="THXM" comment="is on Triple HeXagonal Module"  >
            <Material name="Air"  />
            <Medium name="standard"  />
            <Attribute for="THXM" seen="0" colo="2"  />
            <Shape type="tube" dz="hexg_thick/2" rmin="0" rmax="hexg_irad*2.0/sin(pi/3.0)"  />

            <Do var="J_sing" from="0" to="2"  >

                rsing=hexg_irad/sin(pi/3.0) 
                thesing=J_sing*pi*2.0/3.0 
                <Create block="SHXT"  />
                <Placement y="rsing*sin(thesing)" x="rsing*cos(thesing)" z="0" block="SHXT" in="THXM"  >
                </Placement>
                

            </Do>
            
        </Block>
        
        <Block name="SHXT" comment="is one Single HeXagonal Tile"  >
            <Material name="Air"  />
            <Medium name="standard"  />
            <Attribute for="SHXT" seen="1" colo="6"  />
            <Shape type="PGON" phi1="0" rmn="{0,0}" rmx="{hexg_irad,hexg_irad}" nz="2" npdiv="6" dphi="360" zi="{-hexg_thick/2,hexg_thick/2}"  />

            actr = hexg_irad-hexg_clad 

            <Create block="CLAD"  />
            <Placement y="0" x="0" z="0" block="CLAD" in="SHXT"  >
            </Placement>
            
            <Create block="BPOL"  />
            <Placement y="0" x="0" z="0" block="BPOL" in="SHXT"  >
            </Placement>
            

        </Block>
        
        <Block name="CLAD" comment="is one CLADding of BPOL active region"  >
            <Material name="ALKAP"  />
            <Attribute for="CLAD" seen="1" colo="3"  />
            <Shape type="PGON" phi1="0" rmn="{actr,actr}" rmx="{hexg_irad,hexg_irad}" nz="2" npdiv="6" dphi="360" zi="{-hexg_thick/2,hexg_thick/2}"  />

        </Block>
        
        <Block name="BPOL" comment="is one Bbc POLystyren active scintillator layer"  >
            <Material name="POLYSTYREN"  />
            <Material name="Cpolystyren" isvol="1"  />
            <Attribute for="BPOL" seen="1" colo="4"  />
            <Shape type="PGON" phi1="0" rmn="{0,0}" rmx="{actr,actr}" nz="2" npdiv="6" dphi="360" zi="{-hexg_thick/2,hexg_thick/2}"  />
            <Par name="CUTGAM" value="0.00008"  />
            <Par name="CUTELE" value="0.001"  />
            <Par name="BCUTE" value="0.0001"  />
            <Par name="CUTNEU" value="0.001"  />
            <Par name="CUTHAD" value="0.001"  />
            <Par name="CUTMUO" value="0.001"  />
            <Par name="BIRK1" value="1."  />
            <Par name="BIRK2" value="0.013"  />
            <Par name="BIRK3" value="9.6E-6"  />

            <Instrument block="BPOL">
                <Hit meas="tof"  nbits="16" opts="C" min="0" max="1.0E-6" />
                <Hit meas="birk" nbits="0"  opts="C" min="0" max="10"     />
            </Instrument>

        </Block>
        
    </Module>
    



</Document>

