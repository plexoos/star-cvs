<Document file="StarVMC/Geometry/PixlGeo/PixlGeo4"  >

    <Module name="PixlGeo4" comment="is the SIMPLIFIED pixel detector "  >

        <Created date="  03/13/08 "  />
        <Author name="Gerrit van Nieuwenhuizen"  />
        <CDE  >
            AGECOM
            GCUNIT
        </CDE>
        
        <varlist type="float"  >
            angle,anglePos,angleCorr,raddeg
        </varlist>
        
        <varlist type="int"  >
            nLadder,nSector,nExtraLadder
        </varlist>
        
        <varlist type="float"  >
            LadderRadius,LadderThk,LadderWidth
        </varlist>
        

        <Content  >
            PXMO,PXLA,PLMI,PLAC,PLPS
        </Content>
        
        <Structure name="PXLD"  >
            <var name="version" type="float"  />
            <var name="SubVersion" type="float"  />
            <var name="TotalLength" type="float"  />
            <var name="PassiveThk" type="float"  />
            <var name="ActiveThk" type="float"  />
            <var name="LayerThk" type="float"  />
            <var name="Rin" type="float"  />
            <var name="Rout" type="float"  />
        </Structure>
        

        <Structure name="PIXG"  >
            <var name="Layer" type="float"  />
            <var name="NoLadders" type="float"  />
            <var name="r" type="float"  />
            <var name="a" type="float"  />
            <var name="pOffset" type="float"  />
            <var name="aOffset" type="float"  />
        </Structure>
        
        <Structure name="PXBG"  >
            <var name="version" type="float"  />
            <var name="Length" type="float"  />
            <var name="Rin" type="float"  />
            <var name="Thk" type="float"  />
        </Structure>
        
        <Fill name="PXLD" comment="General pixel parameters"  >
            <var name="Version" value="1.0" comment=" version "  />
            <var name="SubVersion" value="0.0" comment=" sub version "  />
            <var name="TotalLength" value="20.0" comment=" Overal length of the detector "  />
            <var name="PassiveThk" value="0.0280" comment=" Passive silicon Thickness "  />
            <var name="ActiveThk" value="0.0020" comment=" Active  silicon Thickness "  />
            <var name="Rin" value="2.5" comment=" Inner radius "  />
            <var name="Rout" value="8.0" comment=" Outer radius "  />
            <var name="LayerThk" value="0.5" comment=" Thickness of the layer mother volume "  />
        </Fill>
        

        <Fill name="PIXG" comment="Inner layer parameters"  >
            <var name="Layer" value="1" comment=" Layer index  "  />
            <var name="NoLadders" value="10" comment=" Number of ladders "  />
            <var name="r" value="2.5" comment=" 1st ladder nominal radius "  />
            <var name="aOffset" value="-90.0" comment=" Angular offset "  />
            <var name="pOffset" value="0.0" comment=" Position offset (shift) "  />
        </Fill>
        

        <Fill name="PIXG" comment="Outer layer parameters"  >
            <var name="Layer" value="2" comment=" Layer index  "  />
            <var name="NoLadders" value="30" comment=" Number of ladders "  />
            <var name="r" value="8.0" comment=" Ladder radius "  />
            <var name="aOffset" value="-90.0" comment=" Angular offset "  />
            <var name="pOffset" value="0.0" comment=" Position offset (shift) "  />
        </Fill>
        



        raddeg=3.14159265/180.0 
        <Use struct="PXLD" select="Version" value="1 "  />

        LadderThk = PXLD_ActiveThk + PXLD_PassiveThk 


        <!-- Create the pixl mother volume and place it within the inner detector support module -->
        <Create    block="PXMO"  />
        <Placement block="PXMO" in="IDSM"  />
       

        <Volume name="PXMO" comment="is the mother of the pixel detector volumes"  >

            <Material name="Air"  />
            <Attribute for="PXMO" seen="0" colo="6"  />
            <Shape type="TUBE" rmax="PXLD_Rout+PXLD_LayerThk/2.0" rmin="PXLD_Rin-PXLD_LayerThk/2.0" dz="PXLD_TotalLength/2.0"  />


            <Use struct="PIXG" select="Layer" value="1 "  />
            <Create    block="PXLA"  />
            <Placement block="PXLA" />

            
            <Use struct="PIXG" select="Layer" value="2 "  />
            <Create    block="PXLA"  />
            <Placement block="PXLA"  />

            
        </Volume>
        
        <Volume name="PXLA" comment="is the mother of a layer"  >

            <Material name="Air"  />
            <Attribute for="PXLA" seen="0" colo="1"  />
            <Shape type="TUBE" rmax="PIXG_r+PXLD_LayerThk/2.0" rmin="PIXG_r-PXLD_LayerThk/2.0" dz="PXLD_TotalLength/2.0"  />

            LadderRadius = PIXG_r+LadderThk/2.0-PXLD_ActiveThk/2.0 

            LadderWidth = 2.0 * (PIXG_r-PXLD_ActiveThk/2.0) * tan(raddeg*360.0/PIXG_NoLadders/2.0) 

            <Do var="nLadder" from="1" to="PIXG_NoLadders"  >
                angle = (360.0/PIXG_NoLadders)*nLadder 
                anglePos = angle*raddeg 

                <Create block="PLMI"  />
                <Placement block="PLMI" y="LadderRadius*sin(anglePos)" x="LadderRadius*cos(anglePos)" z="0.0" >
                    <Rotation alphaz="angle+PIXG_aOffset"  />
                </Placement>
                
            </Do>
            
        </Volume>
        
        <Volume name="PLMI" comment="is the mother of a silicon ladder"  >
            <Material name="Air"  />
            <Attribute for="PLMI" seen="0" colo="6"  />
            <Shape type="BOX" dz="PXLD_TotalLength/2.0" dx="LadderWidth/2.0" dy="LadderThk/2.0"  />

            <Create block="PLAC"  />
            <Placement block="PLAC" y="-1.0*LadderThk/2.0+PXLD_ActiveThk/2.0" x="0.0" z="0.0"/>
            
            <Create    block="PLPS"  />
            <Placement block="PLPS" y="+1.0*LadderThk/2.0-PXLD_PassiveThk/2.0" x="0.0" z="0.0" />
            
        </Volume>
        
        <Volume name="PLPS" comment="is the passive layer of the ladder"  >
            <Material name="Silicon"  />
            <Attribute for="PLPS" seen="1" colo="4"  />
            <Shape type="BOX" dz="PXLD_TotalLength/2.0" dx="LadderWidth/2.0" dy="PXLD_PassiveThk/2.0"  />

        </Volume>
        
        <Volume name="PLAC" comment="is the active layer of the ladder"  >

            <Material name="Silicon"  />
            <Material name="Sensitive" isvol="1"  />
            <Attribute for="PLAC" seen="1" colo="2"  />
            <Shape type="BOX" dz="PXLD_TotalLength/2.0" dx="LadderWidth/2.0" dy="PXLD_ActiveThk/2.0"  />


            <Instrument block="PLAC"  >
                <Hit meas="z" opts="S" bins=".00001"  />
                <Hit meas="y" bins=".00001"  />
                <Hit meas="x" bins=".00001"  />
                <Hit meas="ptot" nbits="16" min="0" max="100"  />
                <Hit meas="cx" nbits="10"  />
                <Hit meas="cy" nbits="10"  />
                <Hit meas="cz" nbits="10"  />
                <Hit meas="sleng" nbits="16" min="0" max="500"  />
                <Hit meas="tof" nbits="16"  />
                <Hit meas="step" bins=".01"  />
                <Hit meas="eloss" nbits="16"  />
            </Instrument>
            
        </Volume>
        

    </Module>
    


</Document>

