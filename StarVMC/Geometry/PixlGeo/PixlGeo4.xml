<Document file="StarVMC/Geometry/TutrGeo/PixlGeo4.xml">

   <Module name="PixlGeo4" comment="Pixel Detector Geometry  ">

   <Author  name="JB" />
   <Created date="Dec.14 2011" />

<!-- global idea of implementation : all the elements of a single sector are defined according a translation Solidworks to TGeo (F. Videbaek)-->
<!-- once the sector is assembled, it is placed in a trap with opening angles slightly larger (by 1 deg.) than the real geometry -->
<!-- then we duplicate x10 this virtual box and the single sector-->

   <CDE>agecom,gcunit,gconst.</CDE>

   <Content>PXMO, <!-- is the mother volume-->
            PXLA, <!-- is the Pixl Sector volume -->
            PXRB, <!-- Pixl RBEAM  -->
            PXLB, <!-- Pixl LBEAM  -->
            PXIB, <!-- Pixl IBEAM  -->
            PXTR, <!-- Pixl top Length in r/phi right -->
            PXTM, <!-- Pixl top Length in r/phi middle -->
            PXTL, <!-- Pixl top Length in r/phi left -->
            PXTJ, <!-- Pixl top Length in r/phi joined  -->
            PXCA, <!-- Pixl corner A-->
            PXCB, <!-- Pixl corner B-->
            PXCC, <!-- Pixl corner C-->
            PXCD, <!-- Pixl corner D-->
            PXCE, <!-- Pixl corner E-->
            PXCF, <!-- Pixl corner F-->
            PXCG, <!-- Pixl corner G-->
            PXCH, <!-- Pixl corner H-->
            <!--PLMI, : is the mother of a slicon ladder -->
            <!-- PLPS :Pixl silicon passivr length in r/phi -->
            PLAC  <!-- Pixl silicon active length in r/phi -->
   <!-- names/nomenclatures start from a point located a the bottom right of a sector -->
   </Content>

   <varlist type="float" comment=" Ladder half length rigtht side" >  HalfLadRight/2.50864/</varlist>
   <varlist type="float" comment=" Ladder half bottom side" >         HalfLadBottom/0.73364/</varlist>
   <varlist type="float" comment=" Ladder half length left side" >    HalfLadLeft/2.38864/</varlist> 

   <varlist type="float" comment=" Ladder half thickness"       >     HalfLadThk/0.0135/</varlist>
   <varlist type="float" comment=" Ladder half Z length"        >     HalfLadZLen/19.59/</varlist>

   <varlist type="float" comment=" Ladder half length top sector 1" > HalfLadTopR/0.623359/</varlist>
   <!-- equivalent to volume R83 -->
   <varlist type="float" comment=" Ladder half length top sector 2" > HalfLadTopM/0.680382/</varlist>
   <!-- equivalent to volume R82 -->
   <varlist type="float" comment=" Ladder half length top sector 3" > HalfLadTopL/0.661607/</varlist>
   <!-- equivalent to volume R81 -->
   <varlist type="float" comment=" Ladder half length top joining 2 sectors " > HalfLadMid/0.0384251/</varlist>
   <!-- equivalent to volume R01  and R02-->

   <varlist type="float" comment=" rmin for top arc " > ArcTMin/0.123/</varlist>

   <varlist type="float" comment=" rmax for top arc " > ArcTMax/0.15/</varlist>

   <varlist type="float" comment=" rmin for top arc " > ArcTBMin/0.15/</varlist>

   <varlist type="float" comment=" rmax for top arc " > ArcTBMax/0.177/</varlist>

   <varlist type="float" comment=" rmin for bottom arc " > ArcBMin/0.173/</varlist>

   <varlist type="float" comment=" rmax for bottom arc " > ArcBMax/0.2/</varlist>

   <varlist type="float" comment=" silicon pixel active half length in r/phi" > HalfPixR/0.96/</varlist>
   <varlist type="float" comment=" silicon pixel active half thickness" >       HalfPixThk/0.0025/</varlist>
   <varlist type="float" comment=" silicon pixel active half length in Z" >     HalfPixZ/10/</varlist>
   <varlist type="int"   comment=" number of sectors">                           nsector /10/</varlist> 
   <varlist type="float" comment=" min radius of the TUBS defining a sector volume"> minradsec/2.2/</varlist>
   <varlist type="float" comment=" max radius of the TUBS defining a sector volume"> maxradsec/9.5/</varlist>
   <varlist type="float" comment=" Z of the TUBS defining a sector volume"> maxZsec/21/</varlist>
   <varlist type="float" comment=" min radius of the TUBS defining the main volume"> minRvol/1.9/</varlist>
   <varlist type="float" comment=" max radius of the TUBS defining the main volume"> maxRvol/10/</varlist>
   <varlist type="float" comment=" Z of the TUBS defining the main volume"> maxZvol/22/</varlist>
   <varlist type="float" comment=" halfZ of the TUBS defining a sector volume"> halfMaxZ/20.0/</varlist>
<!--   <varlist type="float" comment=" phi1 of the TUBS defining a sector volume"> minphisec/108.0/</varlist>
   <varlist type="float" comment=" phi2 of the TUBS defining a sector volume"> maxphisec/144.0/</varlist>-->
   <varlist type="float" comment=" phi1 of the TUBS defining a sector volume"> minphisec/90.0/</varlist>
   <varlist type="float" comment=" phi2 of the TUBS defining a sector volume"> maxphisec/126.0/</varlist>

   
   <varlist type="float"   comment="internal computations">  xpos,ypos,zpos,angle,anglepos,sector </varlist> 

   <!-- first we create the main volume -->
   
   <Create    block="PXMO" />
   <Placement block="PXMO" in="IDSM" />
   <Volume name="PXMO" comment="Main volume in the AGML tutorial geometry">

   <Material  name="Air"      /> 
   <Attribute for="PXMO" seen="0" colo="6" />

   <Shape type="TUBE" rmin="minRvol" rmax="maxRvol" dz="maxZvol" />
   <Do var="sector" from="1" to="nsector">
     angle=(360.0/nsector)*(sector-1)
     anglepos=angle*(PI/180.0)
     <!-- .0001 is to place the center of the TUBS and to preserve the opening angle of a sector -->
     xpos=.00001*sin(anglepos) 
     ypos=.00001*cos(anglepos)
     zpos =0.0
     <Info format="angle = {5.2f}">angle</Info>
     <Info format="xpos  = {5.2f}">xpos</Info>
     <Info format="ypos  = {5.2f}">ypos</Info>

     <!-- PXLA is the single sector volume-->
     <Create block="PXLA"/>
     <Placement in="PXMO" x="xpos" y="ypos" z="zpos" block="PXLA" konly="'MANY'">
       <Rotation alphaz="-1*angle" />
     </Placement>
   </Do>
   </Volume>

   <!-- volume to contain a single sector = 4 active pixel ladders + mounts -->

   <Volume name="PXLA" comment="pixel sector"  >
   <Material name="Air" />
   <Attribute for="PXMO" seen="0" colo="1" />
   <Shape type="TUBS" dz="halfMaxZ" rmin="minradsec" rmax="maxradsec" phi1="minphisec-5.0" phi2="maxphisec+5.0" />

       <!-- placement of planes -->
       <Create    block="PXRB"  />
       <Placement in ="PXLA" x="-0.1135" y="5.26084" z="-3.07" konly="'MANY'" block="PXRB">
       </Placement>
       <Create    block="PXLB"  />
       <Placement in ="PXLA" x="-3.26838" y="4.69164" z="-3.07" konly="'MANY'" block="PXLB">
       <Rotation alphaz="216"/>
       </Placement>

       <Create    block="PXIB"  />
       <Placement in ="PXLA" x="-0.989084" y="2.64917" z="-3.07" konly="'MANY'" block="PXIB" >
       <Rotation alphaz="267.396-270"/> 
       </Placement>

       <Create    block="PXTR"  />
       <Placement in ="PXLA" x="-0.840029" y="8.01253" z="-3.07" konly="'MANY'" block="PXTR" >
       <Rotation alphaz="79.963-90"/> 
       </Placement>

       <Create    block="PXTM"  />
       <Placement in ="PXLA" x="-2.43058" y="7.66474" z="-3.07" konly="'MANY'" block="PXTM">
       <Rotation alphaz="91.963-90"/> 
       </Placement>

       <Create    block="PXTL"  />
       <Placement in ="PXLA" x="-3.95284" y="6.99643" z="-3.07" konly="'MANY'" block="PXTL">
       <Rotation alphaz="103.693-90"/> 
       </Placement>

       <Create    block="PXTJ"  />
       <Placement in ="PXLA" x="-3.21568" y="7.41527" z="-3.07" konly="'MANY'" block="PXTJ">
       <Rotation alphaz="203.54-270"/> 
       </Placement>

       <Create    block="PXTJ"  />
       <Placement in ="PXLA" x="-1.60369" y="7.92181" z="-3.07" konly="'MANY'" block="PXTJ">
       <Rotation alphaz="191.54-270"/> 
       </Placement>

       <!-- placement of arcs -->

       <Create    block="PXCA"  />
       <Placement in ="PXLA" x="-0.25" y="2.7522" z="-3.07" konly="'MANY'" block="PXCA">
       </Placement>

       <Create    block="PXCC"  />
       <Placement in ="PXLA" x="-0.25" y="7.76948" z="-3.07" konly="'MANY'" block="PXCC">
       </Placement>

       <Create    block="PXCD"  />
       <Placement in ="PXLA" x="-1.47764" y="7.98676" z="-3.07" konly="'MANY'" block="PXCD">
       </Placement>

       <Create    block="PXCE"  />
       <Placement in ="PXLA" x="-1.7562" y="7.85145" z="-3.07" konly="'MANY'" block="PXCE">
       </Placement>

       <Create    block="PXCF"  />
       <Placement in ="PXLA" x="-3.10589" y="7.50501" z="-3.07" konly="'MANY'" block="PXCF">
       </Placement>

       <Create    block="PXCG"  />
       <Placement in ="PXLA" x="-3.35023" y="7.31474" z="-3.07" konly="'MANY'" block="PXCG">
       </Placement>

       <Create    block="PXCH"  />
       <Placement in ="PXLA" x="-4.56196" y="6.70432" z="-3.07" konly="'MANY'" block="PXCH">
       </Placement>

       <Create    block="PXCB"  />
       <Placement in ="PXLA" x="-1.71349" y="2.86881" z="-3.07" konly="'MANY'" block="PXCB">
       </Placement>

       <!-- placement of silicon volume : active+passive elements -->

       <Create    block="PLAC"  />
       <Placement in ="PXLA" x="-1.12166" y="8.16292" z="0" block="PLAC"> <!-- konly="'MANY'" block="PLAC">-->
         <Rotation alphaz="79.963-90"/> 
       </Placement>
       <Create    block="PLAC"  />
       <Placement in="PXLA" x="-2.79431" y="7.75133" z="0" block="PLAC"> <!-- konly="'MANY'" block="PLAC">-->
         <Rotation alphaz="91.963-90"/> 
       </Placement>
       <Create    block="PLAC"  />
         <Placement in="PXLA" x="-4.34484" y="7.00098" z="0" block="PLAC"> <!-- konly="'MANY'" block="PLAC">-->
       <Rotation alphaz="103.693-90"/> 
       </Placement>
<!--
       <Create    block="PLAC"  />
       <Placement in="PXLA" x="-0.84554" y="2.53854" z="0" konly="'MANY'" block="PLAC">
       <Rotation alphaz="87.396-90"/> 
       </Placement>
-->
       <Create    block="PLAC"  />
       <Placement in="PXLA" x="-0.84554" y="2.53854" z="0" block="PLAC"> <!-- konly="'MANY'" block="PLPS">-->
          <Rotation alphaz="87.396-90"/> 
       </Placement>

  <!-- now we close PLAC volume-->
   </Volume>


       <!-- here we define all the shapes -->
       <!-- BOX for planes -->
       <Volume name="PXRB" comment="sector right side"  >
       <Attribute for="PXRB" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="BOX" dz="HalfLadZLen" dx="HalfLadThk" dy="HalfLadRight" />
       </Volume>

       <Volume name="PXLB" comment="sector left side"  >
       <Attribute for="PXLB" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="BOX" dz="HalfLadZLen" dx="HalfLadThk" dy="HalfLadLeft" />
       </Volume>

       <Volume name="PXIB" comment="sector bottom side"  >
       <Attribute for="PXIB" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="BOX" dz="HalfLadZLen" dx="HalfLadBottom" dy="HalfLadThk" />
       </Volume>

       <Volume name="PXTR" comment="part of sector right"  >
       <Attribute for="PXTR" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="BOX" dz="HalfLadZLen" dx="HalfLadTopR" dy="HalfLadThk" />
       </Volume>

       <Volume name="PXTM" comment="part of sector middle"  >
       <Attribute for="PXTM" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="BOX" dz="HalfLadZLen" dx="HalfLadTopM" dy="HalfLadThk" />
       </Volume>

       <Volume name="PXTL" comment="part of sector right"  >
       <Attribute for="PXTL" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="BOX" dz="HalfLadZLen" dx="HalfLadTopL" dy="HalfLadThk" />
       </Volume>

       <Volume name="PXTJ" comment="part joining 2 parts of top sector"  >
       <Attribute for="PXTJ" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="BOX" dz="HalfLadZLen" dx="HalfLadMid" dy="HalfLadThk" />
       </Volume>

       <!-- TUBS for arcs -->

       <Volume name="PXCA" comment="arc bottom right"  >
       <Attribute for="PXCA" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="TUBS" dz="HalfLadZLen" rmin="ArcTMin" rmax="ArcTMax" phi1="267.396" phi2="360"/>
       </Volume>

       <Volume name="PXCC" comment="arc top right"  >
       <Attribute for="PXCC" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="TUBS" dz="HalfLadZLen" rmin="ArcTMin" rmax="ArcTMax" phi1="0" phi2="79.963"/>
       </Volume>

       <Volume name="PXCD" comment="arc top 23"  >
       <Attribute for="PXCD" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="TUBS" dz="HalfLadZLen" rmin="ArcTMin" rmax="ArcTMax" phi1="79.963" phi2="191.54"/>
       </Volume>

       <Volume name="PXCE" comment="arc bottom 23"  >
       <Attribute for="PXCE" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="TUBS" dz="HalfLadZLen" rmin="ArcTBMin" rmax="ArcTBMax" phi1="271.963" phi2="371.54"/>
       </Volume>

       <Volume name="PXCF" comment="arc top 12"  >
       <Attribute for="PXCF" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="TUBS" dz="HalfLadZLen" rmin="ArcTMin" rmax="ArcTMax" phi1="91.963" phi2="203.54"/>
       </Volume>

       <Volume name="PXCG" comment="arc bottom 12"  >
       <Attribute for="PXCG" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="TUBS" dz="HalfLadZLen" rmin="ArcTBMin" rmax="ArcTBMax" phi1="283.963" phi2="383.54"/>
       </Volume>

       <Volume name="PXCH" comment="arc top left"  >
       <Attribute for="PXCH" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="TUBS" dz="HalfLadZLen" rmin="ArcTMin" rmax="ArcTMax" phi1="103.963" phi2="216"/>
       </Volume>

       <Volume name="PXCB" comment="arc bottom left"  >
       <Attribute for="PXCB" seen="1" colo="4"  />
       <Material name="Carbon"  />
       <Shape type="TUBS" dz="HalfLadZLen" rmin="ArcBMin" rmax="ArcBMax" phi1="216" phi2="267.396"/>
       </Volume>

       <!-- BOX for silicon active ladders -->
       <Volume name="PLAC" comment="active silicon top sector"  >
       <Material name="Sensitive" isvol="1"/>
       <Attribute for="PLAC" seen="1" colo="5"  />
       <Material name="Silicon"  />
       <Shape type="BOX" dz="HalfPixZ" dx="HalfPixR" dy="HalfPixThk" />
            <Instrument block="PLAC"  >
                <Hit meas="z" bins=".00001"  />  <!-- remove opts="S" -->
                <Hit meas="y" bins=".00001"  />
                <Hit meas="x" bins=".00001"  />
                <Hit meas="ptot" nbits="16" min="0" max="100"  />
                <Hit meas="cx" nbits="10"  />
                <Hit meas="cy" nbits="10"  />
                <Hit meas="cz" nbits="10"  />
                <Hit meas="sleng" nbits="16" min="0" max="500"  />
                <Hit meas="tof" nbits="16"  />
                <Hit meas="step" bins=".01"  />
                <Hit meas="eloss" nbits="16"  />
            </Instrument>
       </Volume>
       <!-- silicon -->
<!--
       <Volume name="PLPS" comment="active silicon bottom sector"  >
       <Material name="Sensitive" isvol="1"/>
       <Attribute for="PLPS" seen="1" colo="6"  />
       <Material name="Silicon"  />
       <Shape type="BOX" dz="HalfPixZ" dx="HalfPixR" dy="HalfPixThk" />
            <Instrument block="PLPS"  >
                <Hit meas="z" opts="S" bins=".00001"  />
                <Hit meas="y" bins=".00001"  />
                <Hit meas="x" bins=".00001"  />
                <Hit meas="ptot" nbits="16" min="0" max="100"  />
                <Hit meas="cx" nbits="10"  />
                <Hit meas="cy" nbits="10"  />
                <Hit meas="cz" nbits="10"  />
                <Hit meas="sleng" nbits="16" min="0" max="500"  />
                <Hit meas="tof" nbits="16"  />
                <Hit meas="step" bins=".01"  />
                <Hit meas="eloss" nbits="16"  />
            </Instrument>

       </Volume>
-->
</Module>
</Document>