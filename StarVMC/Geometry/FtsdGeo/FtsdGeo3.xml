<Document  file="StarVMC/Geometry/FtsdGeo/FtsdGeo3.xml">

<Replace match="GeV">*1.0E+0;</Replace>    
<Replace match="MeV">*1.0E-3;</Replace>    
<Replace match="keV">*1.0E-6;</Replace>

<Module name="FtsdGeo3" comment="Forward Tracking System Geometry / development for Si tracker">

  <Created date="03/15/2018" />
  <Author  name="Guannan Xie" />
  <CDE>AGECOM,GCONST,GCUNIT</CDE>
  
  <Content>
    FTSM,  <!-- FTS Mother volume -->    
    FTSD, <!-- Volume for each FTS disk           -->
    FTSA, <!-- Active volume for each FTS disk    -->
    FTSS, <!-- Support material for each FTS disk -->
    FSTA,
    FSTB,
    FSTC,
    FSIA,  <!-- FTS Si sensor -->
    FSIB,
    FSIC


  </Content>

  <Structure name="MAIN" comment="Main configuration control structure, selects version at run time">
    <var name="version" type="float" />
    <var name="type"    type="int" />
    <var name="layout"    type="int" />
    <var name="useids"  type="float" />
    <var name="active(20)" type="float" />
    <var name="rmnDSK" type="float" /> <!-- min disk radius -->
    <var name="rmxDSK" type="float" /> <!-- max disk radius -->
    <var name="cutele" type="float" />
    <var name="rotatez" type="float" />
    <var name="zsi(3)"  type="float" />
    <var name="bmc(3)" type="float" /> 
    <var name="bmo(3)" type="float" />
    <var name="delta" type="float" />
  </Structure>

  <Structure name="FDSK" comment="Description of each disk">
    <var name="version" type="float" />
    <var  name="diskid"   type="int"   />
    <var  name="x"    type="float" />
    <var  name="y"    type="float" />
    <var  name="z"    type="float" />
    <var  name="rmax" type="float" />
    <var  name="rmin" type="float" />
    <var  name="rmaxsens" type="float" />
    <var  name="rminsens" type="float" />
    <var  name="thksens" type="float" />
    <var  name="thksupp" type="float" />
  </Structure>

  <Structure name="SITC"  comment="Control for Si tracking stations">
    <var name="version" type="float" />
    <var name="plane"     type="float" />
    <var name="station"   type="int" />
    <var name="on"        type="int" />
    <var name="z"         type="float" />
    <var name="alpha"     type="float" />
    <var name="ring1(4)"  type="int" />
    <var name="ring2(8)"  type="int" />
    <var name="ring3(12)" type="int" />
    <var name="ring4(16)" type="int" />
    <var name="ring5(20)" type="int" />
    <var name="ring6(24)" type="int" />
    <var name="ring4off"  type="float" />
    <var name="ring5off"  type="float" />
    <var name="ring6off"  type="float" />
  </Structure>

  <varlist type="int">
    ndisk/0/, idisk/0/, isensor/0/, iblade/0/
  </varlist>

  <varlist type="float">
    zmin,    <!-- minimum z for mother volume -->
    zmax,    <!-- maximum z for mother volume -->
    rmin,    <!-- minimum r for mother volume -->
    rmax,    <!-- maximum r for mother volume -->
    xcenter, <!-- used for positioning volumes -->
    ycenter, <!-- used for positioning volumes -->
    zcenter, <!-- used for positioning volumes -->
    rc,xc,yc, <!-- used for positioning volumes -->
    bmclear/3.2/, <!-- beam clearance -->
    dyblade,
    zdisk,
    dzdisk,
    Rin/0/,
    Rout/0/
  </varlist>

  <varlist type="int"> station </varlist>

  <Inline name="eta2tan" type="real">
    <Arguement type="real" name="etax" />
    <Return value="tan(2*atan(exp(-etax)))" />
  </Inline>

  <Fill name="MAIN" comment="Select configuration" >
    <var name="version" value="3.0" comment="selector" />
    <var name="useids"  value="0.0" comment="defines placement 0=in cave, 1=in idsm, 2=in scon" />
    <var name="active"  value="{1,1,1,1,1, 1,1,1,1,1, 1,1,1,1,1, 1,1,1,1,1}" comment="switch on/off up to 20 disks" />
    <var name="rmnDSK"  value="2.25" comment="default disk inner radius" />
    <var name="rmxDSK"  value="32.5" comment="default disk outer radius" />
    <var name="cutele"  value="1 MeV" comment="electron propagation threshold" />
    <var name="type"    value="1" comment="This is combined Si+sTGC with 3 Si planes" />
    <var name="rotatez" value="0" comment="rotation angles for disk 2 and 3"/>
    <var name="zsi"     value="{93.3, 140.0, 186.6}" comment="Positions of the Si disks" />
    <var name="bmc"     value="{1.6, 2.0, 3.0}" comment="beam clearance" />
    <var name="delta"  value="1.0" comment="distance between planes in station" />
  </Fill>
  <Use struct="MAIN" />



  <If expr="MAIN_version==3.0">
    
    zdisk  = 70.0;
    dzdisk = 23.3333333;
    Rin    = MAIN_rmndsk !2.25
    Rout   = MAIN_rmxdsk !32.25
    
    <!--                                                                                     Geometric paramters for disk 1 -->
    ndisk = ndisk + 1
    <Fill name="FDSK" comment="First disk">
        <var name="version"   value="1.0"    comment="disk version" />
        <var name="diskid"    value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk"   comment="z center of disk [cm]" />
        <var name="rmin"      value="Rin-0.5"   comment="minimum radius of disk [cm]" />
        <var name="rmax"      value="Rout+0.5"  comment="maximum radius of disk [cm]" />
        <var name="rminsens"  value="Rin"   comment="minimum radius of sensitive layer [cm]" />
        <var name="rmaxsens"  value="Rout"   comment="maximum radius of sensitive layer [cm]" />
        <var name="thksens"   value="0.03744"    comment="thickness of sensitive layer [cm]" />
        <var name="thksupp"   value="0.8"    comment="thickness of support material [cm]" />
    </Fill>
    zdisk = zdisk + dzdisk
    
    <!--                                                                                     Geometric paramters for disk 2 -->
    ndisk = ndisk + 1
    <Fill name="FDSK" comment="Second disk">
        <var name="version"   value="1.1"    comment="disk version" />
        <var name="diskid"        value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk"  comment="z center of disk [cm]" />
    </Fill>
    zdisk = zdisk + dzdisk
    
    <!--                                                                                     Geometric paramters for disk 3 -->
    ndisk = ndisk + 1
    <Fill name="FDSK" comment="Third disk">
        <var name="version"   value="1.2"    comment="disk version" />
        <var name="diskid"    value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk" comment="z center of disk [cm]" />
    </Fill>
    zdisk = zdisk + dzdisk
    
    ndisk = ndisk + 1
    <Fill name="FDSK" comment="Fourth disk">
        <var name="version"   value="1.3"    comment="disk version" />
        <var name="diskid"    value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk"  comment="z center of disk [cm]" />
    </Fill>
    zdisk = zdisk + dzdisk
    
    ndisk = ndisk + 1
    <Fill name="FDSK" comment="Fifth disk">
        <var name="version"   value="1.4"    comment="disk version" />
        <var name="diskid"    value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk"  comment="z center of disk [cm]" />
    </Fill>
    zdisk = zdisk + dzdisk
    
    ndisk = ndisk + 1
    <Fill name="FDSK" comment="Sixth disk">
        <var name="version"   value="1.5"    comment="disk version" />
        <var name="diskid"    value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk"  comment="z center of disk [cm]" />
    </Fill>
    
    
    
    <!--                                                                                     Geometric paramters for disk s -->
    zdisk = 238.0; <!-- place outside magnet -->
    ndisk = ndisk + 1
    Rin  = 6.0
    Rout = (Rin + 30.0) / cos(pi/8.0)
    <Fill name="FDSK" comment="First disk">
        <var name="version"   value="1.0"    comment="disk version" />
        <var name="diskid"    value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk"   comment="z center of disk [cm]" />
        <var name="rmin"      value="Rin-0.5"    comment="minimum radius of disk [cm]" />
        <var name="rmax"      value="Rout+0.5"   comment="maximum radius of disk [cm]" />
        <var name="rminsens"  value="Rin"   comment="minimum radius of sensitive layer [cm]" />
        <var name="rmaxsens"  value="Rout"   comment="maximum radius of sensitive layer [cm]" />
        <var name="thksens"   value="0.03744"    comment="thickness of sensitive layer [cm]" />
        <var name="thksupp"   value="0.8"    comment="thickness of support material [cm]" />
    </Fill>
    
    zdisk = 243.0; <!-- second 4 cm separation -->
    ndisk = ndisk + 1
    <Fill name="FDSK" comment="wheel 2">
        <var name="version"   value="1.0"    comment="disk version" />
        <var name="diskid"    value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk"   comment="z center of disk [cm]" />
        <var name="rmin"      value="Rin-0.5"    comment="minimum radius of disk [cm]" />
        <var name="rmax"      value="Rout+0.5"   comment="maximum radius of disk [cm]" />
        <var name="rminsens"  value="Rin"   comment="minimum radius of sensitive layer [cm]" />
        <var name="rmaxsens"  value="Rout"   comment="maximum radius of sensitive layer [cm]" />
        <var name="thksens"   value="0.03744"    comment="thickness of sensitive layer [cm]" />
        <var name="thksupp"   value="0.8"    comment="thickness of support material [cm]" />
    </Fill>
    <!--                                                                                     Geometric paramters for disk s -->
    Rout = (Rin+60)/cos(pi/8)
    zdisk = 273.0; <!-- place outside magnet -->
    ndisk = ndisk + 1
    <Fill name="FDSK" comment="wheel 3">
        <var name="version"   value="1.0"    comment="disk version" />
        <var name="diskid"    value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk"   comment="z center of disk [cm]" />
        <var name="rmin"      value="Rin-0.5"    comment="minimum radius of disk [cm]" />
        <var name="rmax"      value="Rout+0.5"   comment="maximum radius of disk [cm]" />
        <var name="rminsens"  value="Rin"   comment="minimum radius of sensitive layer [cm]" />
        <var name="rmaxsens"  value="Rout"   comment="maximum radius of sensitive layer [cm]" />
        <var name="thksens"   value="0.03744"    comment="thickness of sensitive layer [cm]" />
        <var name="thksupp"   value="0.8"    comment="thickness of support material [cm]" />
    </Fill>
    
    zdisk = 303.0; <!-- second 4 cm separation -->
    ndisk = ndisk + 1
    <Fill name="FDSK" comment="wheel 4">
        <var name="version"   value="1.0"    comment="disk version" />
        <var name="diskid"    value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk"   comment="z center of disk [cm]" />
        <var name="rmin"      value="Rin-0.5"    comment="minimum radius of disk [cm]" />
        <var name="rmax"      value="Rout+0.5"   comment="maximum radius of disk [cm]" />
        <var name="rminsens"  value="Rin"   comment="minimum radius of sensitive layer [cm]" />
        <var name="rmaxsens"  value="Rout"   comment="maximum radius of sensitive layer [cm]" />
        <var name="thksens"   value="0.03744"    comment="thickness of sensitive layer [cm]" />
        <var name="thksupp"   value="0.8"    comment="thickness of support material [cm]" />
    </Fill>
    <!--                                                                                     Geometric paramters for disk s -->
    zdisk = 333.0; <!-- place outside magnet -->
    ndisk = ndisk + 1
    
    <Fill name="FDSK" comment="wheel 5">
        <var name="version"   value="1.0"    comment="disk version" />
        <var name="diskid"    value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk"   comment="z center of disk [cm]" />
        <var name="rmin"      value="Rin-0.5"    comment="minimum radius of disk [cm]" />
        <var name="rmax"      value="Rout+0.5"   comment="maximum radius of disk [cm]" />
        <var name="rminsens"  value="Rin"   comment="minimum radius of sensitive layer [cm]" />
        <var name="rmaxsens"  value="Rout"   comment="maximum radius of sensitive layer [cm]" />
        <var name="thksens"   value="0.03744"    comment="thickness of sensitive layer [cm]" />
        <var name="thksupp"   value="0.8"    comment="thickness of support material [cm]" />
    </Fill>
    
    zdisk = 362.0; <!-- second 4 cm separation -->
    ndisk = ndisk + 1
    <Fill name="FDSK" comment="wheel 6">
        <var name="version"   value="1.0"    comment="disk version" />
        <var name="diskid"    value="ndisk"  comment="disk number" />
        <var name="x"         value="0.0"    comment="x center of disk [cm]" />
        <var name="y"         value="0.0"    comment="y center of disk [cm]" />
        <var name="z"         value="zdisk"   comment="z center of disk [cm]" />
        <var name="rmin"      value="Rin-0.5"    comment="minimum radius of disk [cm]" />
        <var name="rmax"      value="Rout+0.5"   comment="maximum radius of disk [cm]" />
        <var name="rminsens"  value="Rin"   comment="minimum radius of sensitive layer [cm]" />
        <var name="rmaxsens"  value="Rout"   comment="maximum radius of sensitive layer [cm]" />
        <var name="thksens"   value="0.03744"    comment="thickness of sensitive layer [cm]" />
        <var name="thksupp"   value="0.8"    comment="thickness of support material [cm]" />
    </Fill>
    
  </If>
  <Use struct="FDSK" />



  <Fill name="SITC" comment="Station 1 | plane 1">
    <var name="version" value="1.0" comment="version" />
    <var name="station" value="1"   comment="station 1 of 3" />
    <var name="plane"   value="1"   comment="1 to 6" />
    <var name="on"      value="MAIN_active(1)"   comment="default on" />
    <var name="alpha"   value="0.0" comment="rotation angle" />
    <var name="ring1"   value="{1,1,1,1}" />
    <var name="ring2"   value="{1,1,1,1,1,1,1,1}" />
    <var name="ring3"   value="{1,1,1,1,1,1,1,1,1,1,1,1}" />
    <var name="ring4"   value="{0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0}" />
    <var name="ring5"   value="{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}" />
    <var name="ring6"   value="{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}" />
    <var name="ring4off" value="3.1" />
    <var name="ring5off" value="3.1" />
    <var name="ring6off" value="3.1" />
  </Fill>
  <Fill name="SITC" comment="Station 1 | plane 2">
    <var name="version" value="2.0" comment="version" />
    <var name="station" value="1"   comment="station 1 of 3" />
    <var name="plane"   value="2"   comment="1 to 6" />
    <var name="on"      value="MAIN_active(2)"   comment="default on" />
    <var name="alpha"   value="45.0" comment="rotation angle" />
  </Fill>
  <Fill name="SITC" comment="Staeion 2 | plane 3">
    <var name="version" value="3.0" comment="version" />
    <var name="station" value="2"   comment="station 2 of 3" />
    <var name="plane"   value="3"   comment="1 to 6" />
    <var name="on"      value="MAIN_active(3)"   comment="default on" />
    <var name="alpha"   value="+15.0" comment="rotation angle" />
    <var name="ring1"   value="{1,1,1,1}" />
    <var name="ring2"   value="{1,1,1,1,1,1,1,1}" />
    <var name="ring3"   value="{1,1,1,1,1,1,1,1,1,1,1,1}" />
    <var name="ring4"   value="{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}" />
    <var name="ring5"   value="{0,1,1,1,0,0,1,1,1,0,0,1,1,1,0,0,1,1,1,0}" />
    <var name="ring6"   value="{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}" />
    <var name="ring4off" value="0" />
    <var name="ring5off" value="3.1"/>
    <var name="ring6off" value="3.1" />
  </Fill>
  <Fill name="SITC" comment="Station 2 | plane 4">
    <var name="version" value="4.0" comment="version" />
    <var name="station" value="2"   comment="station 2 of 3" />
    <var name="plane"   value="4"   comment="1 to 6" />
    <var name="on"      value="MAIN_active(4)"   comment="default on" />
    <var name="alpha"   value="+60.0" comment="rotation angle" />
  </Fill>
  <Fill name="SITC" comment="Station 3 | plane 5">
    <var name="version" value="5.0" comment="version" />
    <var name="station" value="3"   comment="station 2 of 3" />
    <var name="plane"   value="5"   comment="1 to 6" />
    <var name="on"      value="MAIN_active(5)"   comment="default on" />
    <var name="alpha"   value="+30.0" comment="rotation angle" />
    <var name="ring1"   value="{1,1,1,1}" />
    <var name="ring2"   value="{1,1,1,1,1,1,1,1}" />
    <var name="ring3"   value="{1,1,1,1,1,1,1,1,1,1,1,1}" />
    <var name="ring4"   value="{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}" />
    <var name="ring5"   value="{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}" />
    <var name="ring6"   value="{0,1,1,1,1,0,0,1,1,1,1,0,0,1,1,1,1,0,0,1,1,1,1,0}" />
    <var name="ring4off" value="0" />
    <var name="ring5off" value="0"/>
    <var name="ring6off" value="3.1" />
  </Fill>
  <Fill name="SITC" comment="Station 3 | plane 6">
    <var name="version" value="6.0" comment="version" />
    <var name="station" value="3"   comment="station 2 of 3" />
    <var name="plane"   value="6"   comment="1 to 6" />
    <var name="on"      value="MAIN_active(6)"   comment="default on" />
    <var name="alpha"   value="+75.0" comment="rotation angle" />
  </Fill>
  <Use struct="SITC" />





  <!-- set zmin, zmax, rmin, rmax -->
  <Use struct="FDSK" select="diskid" value="1" />

  !zmin = FDSK_z    - FDSK_thksupp
  !rmin = FDSK_rmin                 <!-- set mother volume zmin (Assumes all are the same) -->

zmin = 35.0
rmin = 2.0 

  <Use struct="FDSK" select="diskid" value="ndisk" />

  zmax = FDSK_z    + FDSK_thksupp
  rmax = FDSK_rmax                  <!-- set mother volume rmax (Assumes last disk is largest) -->

  <!--                                                                Create and place the FSTM mother volume in the CAVE -->
  xcenter = 0
  ycenter = 0
  zcenter = zmin + (zmax-zmin) / 2.0

  <Info format="SELECT MAIN_version = {6.2f}">MAIN_version</Info>
  <Info format="ndisk = {2i}">ndisk</Info>
  <Info format="zmin = {6.2f}">zmin</Info>
  <Info format="zmax = {6.2f}">zmax</Info>
  <Info format="rmin = {6.2f}">rmin</Info>
  <Info format="rmax = {6.2f}">rmax</Info>


  <Create    block="FTSM" />

  <!-- we used xcenter,ycenter as temporary variables in other volumes, so need to reset here -->



  <Placement block="FTSM" in="IDSM" konly="MANY"      if="MAIN_useids.eq.1.0"
    x="xcenter"
    y="ycenter"
    z="zcenter" />

  <Placement block="FTSM" in="CAVE" konly="MANY"      if="MAIN_useids.eq.0.0"
    x="xcenter"
    y="ycenter"
    z="zcenter" />

  <Placement block="FTSM" in="SCON" konly="MANY"      if="MAIN_useids.eq.2.0"
    x="xcenter"
    y="ycenter"
    z="zcenter" />

  <Volume name="FTSM" comment="FTS mother volume"  >
    <Material name="Air" />
    <Shape type="tube"
    rmin="rmin"
    rmax="rmax"
    dz="(zmax-zmin)/2.0" />

  <!-- loop over and place all disks -->
  <For var="idisk" from="7" to="ndisk">
    
    <!-- Load disk "idisk" into data structure -->
    <Use struct="FDSK" select="diskid" value="idisk" />
    
    <!-- Create and place the disk -->
    <If expr="MAIN_active(idisk).eq.1">
        <Create    block="FTSD" />
        <Placement block="FTSD" in="FTSM" x="FDSK_x" y="FDSK_y" z="FDSK_z-zcenter" ncopy="idisk"   />
        <Info format="Positioning FTSD {2I}">idisk</Info>
    </If>
    
  </For>


  station = 1;   <Use       struct = "SITC" select="plane" value="1" />

  <Create    block  = "FSTA"/>  
  <Placement block  = "FSTA" in="FTSM"  z="MAIN_zsi(1)-zcenter" if="SITC_on==1" >
    <Rotation alphaz="SITC_alpha" />
  </Placement>

  <Use       struct = "SITC" select="plane" value="2" />
  <Placement block  = "FSTA" in="FTSM"  z="MAIN_zsi(1)-zcenter+MAIN_delta" if="SITC_on==1" >
    <Rotation alphaz="SITC_alpha" />
  </Placement>

  station = 2;      <Use       struct = "SITC" select="plane" value="3" />

  <Create    block  = "FSTB"/> 
  <Placement block  = "FSTB" in="FTSM"  z="MAIN_zsi(2)-zcenter" if="SITC_on==1" >
    <Rotation alphaz="SITC_alpha" />
  </Placement>

  <Use       struct = "SITC" select="plane" value="4" />
  <Placement block  = "FSTB" in="FTSM"  z="MAIN_zsi(2)-zcenter+MAIN_delta" if="SITC_on==1" >
    <Rotation alphaz="SITC_alpha" />
  </Placement>


  station = 3;   <Use       struct = "SITC" select="plane" value="5" />

  <Create    block="FSTC"/>  
  <Placement block="FSTC" in="FTSM"  z="MAIN_zsi(3)-zcenter" if="SITC_on==1" >
    <Rotation alphaz="SITC_alpha" />
  </Placement>

  <Use       struct = "SITC" select="plane" value="6" />
  <Placement block="FSTC" in="FTSM"  z="MAIN_zsi(3)-zcenter+MAIN_delta" if="SITC_on==1" >
    <Rotation alphaz="SITC_alpha" />
  </Placement>

  </Volume>
  <!--                                                             FTSD represents the disks in the FTS.  One new object 
                                                                   will be created for each disk based on the dimensions 
                                                                   provided in the DISK structure -->
  <Volume name="FTSD" comment="FTS disk">

    <Attribute for="FTSD" seen="0" colo="3" />
    <Shape type="TUBE"
           rmin="FDSK_rmin"
           rmax="FDSK_rmax"
           dz="FDSK_thksupp" />

    <Create    block="FTSA" />
    <Placement block="FTSA" rmin="FDSK_rminsens" rmax="FDSK_rmaxsens" dz="FDSK_thksens" />

    <Create    block="FTSS" />
    <Placement block="FTSS" rmin="FDSK_rmin"     rmax="FDSK_rminsens" dz="FDSK_thksupp" />
    <Placement block="FTSS" rmin="FDSK_rmaxsens" rmax="FDSK_rmax"     dz="FDSK_thksupp" />

  </Volume>
  <!--                                                                                                     Active volume -->
  <Volume name="FTSA" comment="Active volume of the FTS">
    <Attribute for="FTSA" seen="1" colo="4" />
    <Material name="silicon" />
    <Material name="silicon" isvol="1" />
    <Shape type="TUBE"
           rmin="0"
           rmax="0"
           dz="0" />

    <Par name="CUTGAM" value="1 MeV" />
    <Par name="CUTELE" value="MAIN_cutele" />
    <Par name="CUTNEU" value="10 keV" />
    <Par name="CUTHAD" value="10 keV" />
    <Par name="CUTMUO" value="10 keV" />
    <Par name="BCUTE"  value="1 MeV" />
    <Par name="DCUTE"  value="10000 GeV" />
    <Par name="DCUTM"  value="10000 GeV" />
    <Par name="PPCUTM" value="10 keV" />

        <Instrument block="FTSA"  >
             <Hit meas="zz" opts="S" bins="0.00001"  />
             <Hit meas="yy" opts="S" bins="0.00001"  />
             <Hit meas="xx" opts="S" bins="0.00001"  />
             <Hit meas="z"  opts="S" bins="0.00001"  />
             <Hit meas="y"  opts="S" bins="0.00001"  />
             <Hit meas="x"  opts="S" bins="0.00001"  />
             <Hit meas="ptot" nbits="16" min="0" max="100"  />
             <Hit meas="cx" nbits="10"  />
             <Hit meas="cy" nbits="10"  />
             <Hit meas="cz" nbits="10"  />
             <Hit meas="sleng" nbits="16" min="0" max="500"  />
             <Hit meas="tof" nbits="16"  />
             <Hit meas="step" bins=".0001"  />
             <Hit meas="eloss" nbits="16"  />
       </Instrument>
  </Volume>
  <!--                                                                                                 Support strucutres -->
  <Volume name="FTSS" comment="Support structure for each disk"  >

    <Attribute for="FTSS" seen="1" colo="920" />
    <Material name="CFRPmix"  a="12" z="6"
	      dens="1.3"
	      radl="23.9" />

    <Shape type="TUBE" rmin="0" rmax="0" dz="0" />

  </Volume>

  <Volume name="FSTA" comment="Station A">
    <Material  name="Air" />

    <Attribute for="FSTA" seen="1" colo="2" />
    <Shape     type="tube" rmin="3.0" rmax="20.0" dz="2.0" />

dyblade = 12.2

    <Create    block="FTSS"/>
    <Placement block="FTSS" rmin="MAIN_bmo(1)" rmax="MAIN_bmc(1)" dz="2.0" />
    <Placement block="FTSS" rmin="MAIN_bmc(1)+21.0" rmax="MAIN_bmc(1)+21.25" dz="2.0" if="MAIN_layout.eq.1" />
    <Placement block="FTSS" rmin="MAIN_bmc(1)+dyblade+0.6" rmax="MAIN_bmc(1)+dyblade+0.85" dz="2.0" if="MAIN_layout.eq.2" />

  
    <Create block="FSIA" />

    <!-- beam clearance -->
    bmclear = MAIN_bmc(1)

    <If expr="MAIN_layout.eq.1"><Do var="iblade" from="1" to="12">

      <!-- Spoke 1 -->
      rc = (bmclear + 3.1)
      xc = rc     * cos( 30.0*degrad*(iblade-1) + 90*degrad)
      yc = rc     * sin( 30.0*degrad*(iblade-1) + 90*degrad)

      <Placement block="FSIA" dx="6.4/2" dy="6.2/2" dz="0.03" x="xc" y="yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-1)" />
      </Placement>

      rc = (bmclear +       12.4)
      xc = rc           * cos( 30.0*degrad*(iblade-1) + 90*degrad)
      yc = rc           * sin( 30.0*degrad*(iblade-1) + 90*degrad)

      <Placement block="FSIA" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-1)" />

      </Placement>


      <!-- ##################################################################### Spoke 2 ### -->
      rc = (bmclear + 6.2 + 7.75)
      xc = (bmclear + 6.2 + 7.75) * cos( 30.0*degrad*(iblade-0.5) + 90*degrad)
      yc = (bmclear + 6.2 + 7.75) * sin( 30.0*degrad*(iblade-0.5) + 90*degrad)

      <Placement block="FSIA" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-0.5)" />

      </Placement>

    </Do></If>
    <If expr="MAIN_layout.eq.2"><Do var="iblade" from="1" to="15">
      

      rc = bmclear + dyblade/2.0;
      xc = rc     * cos( (360/15)*degrad*(iblade-1) + 90*degrad)
      yc = rc     * sin( (360/15)*degrad*(iblade-1) + 90*degrad)

      <Placement block="FSIA" dx="6.4/2" dy="dyblade/2" dz="0.03" x="xc" y="yc" >
	<Rotation alphax="-15.0" />
	<Rotation alphay="15.0" />
	<Rotation alphaz="(360.0/15)*(iblade-1)" />
      </Placement>

    </Do></If>


  </Volume>
  <Volume name="FSTB" comment="Station B">
    <Material  name="Air" />
    <Attribute for="FSTB" seen="1" colo="3" />
    <Shape     type="tube" rmin="3.0" rmax="25.0" dz="1.0" />

    <Create    block="FTSS"/>
    <Placement block="FTSS" rmin="MAIN_bmo(2)" rmax="MAIN_bmc(2)" dz="2.0" />
    <Placement block="FTSS" rmin="MAIN_bmc(2)+21.0" rmax="MAIN_bmc(2)+21.25" dz="2.0" if="MAIN_layout.eq.1" />
    <Placement block="FTSS" rmin="MAIN_bmc(2)+13.0" rmax="MAIN_bmc(2)+13.25" dz="2.0" if="MAIN_layout.eq.2" />

    <Create block="FSIB" />
    <!-- beam clearance -->
    bmclear = MAIN_bmc(2)
    
    <If expr="MAIN_layout.eq.1"><Do var="iblade" from="1" to="12">

      <!-- Spoke 1 -->
      rc = (bmclear + 3.1)
      xc = rc     * cos( 30.0*degrad*(iblade-1) + 90*degrad)
      yc = rc     * sin( 30.0*degrad*(iblade-1) + 90*degrad)

      <Placement block="FSIB" dx="6.4/2" dy="6.2/2" dz="0.03" x="xc" y="yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-1)" />
      </Placement>

      rc = (bmclear +       12.4)
      xc = rc           * cos( 30.0*degrad*(iblade-1) + 90*degrad)
      yc = rc           * sin( 30.0*degrad*(iblade-1) + 90*degrad)

      <Placement block="FSIB" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-1)" />

      </Placement>


      <!-- ##################################################################### Spoke 2 ### -->
      rc = (bmclear + 6.2 + 7.75)
      xc = (bmclear + 6.2 + 7.75) * cos( 30.0*degrad*(iblade-0.5) + 90*degrad)
      yc = (bmclear + 6.2 + 7.75) * sin( 30.0*degrad*(iblade-0.5) + 90*degrad)

      <Placement block="FSIB" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-0.5)" />

      </Placement>


    </Do></If>
    <If expr="MAIN_layout.eq.2"><Do var="iblade" from="1" to="15">
      
      rc = bmclear + 6.2;
      xc = rc     * cos( (360/15)*degrad*(iblade-1) + 90*degrad)
      yc = rc     * sin( (360/15)*degrad*(iblade-1) + 90*degrad)

      <Placement block="FSIB" dx="6.4/2" dy="12.4/2" dz="0.03" x="xc" y="yc" >
	<Rotation alphax="-15.0" />
	<Rotation alphay="15.0" />
	<Rotation alphaz="(360.0/15)*(iblade-1)" />
      </Placement>

    </Do></If>


  </Volume>
  <Volume name="FSTC" comment="Station C">

    <Material  name="Air" />
    <Attribute for="FSTC" seen="1" colo="4" />
    <Shape     type="tube" rmin="3.0" rmax="30.0" dz="1.0" /> 

    <Create    block="FTSS"/>
    <Placement block="FTSS" rmin="MAIN_bmo(3)" rmax="MAIN_bmc(3)" dz="2.0" />
    <Placement block="FTSS" rmin="MAIN_bmc(3)+21.0" rmax="MAIN_bmc(3)+21.25" dz="2.0" if="MAIN_layout.eq.1" />
    <Placement block="FTSS" rmin="MAIN_bmc(3)+13.0" rmax="MAIN_bmc(3)+13.25" dz="2.0" if="MAIN_layout.eq.2" />

    <Create block="FSIC" />
    <!-- beam clearance -->
    bmclear = MAIN_bmc(3)    

    <If expr="MAIN_layout.eq.1"><Do var="iblade" from="1" to="12">

      <!-- Spoke 1 -->
      rc = (bmclear + 3.1)
      xc = rc     * cos( 30.0*degrad*(iblade-1) + 90*degrad)
      yc = rc     * sin( 30.0*degrad*(iblade-1) + 90*degrad)

      <Placement block="FSIC" dx="6.4/2" dy="6.2/2" dz="0.03" x="xc" y="yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-1)" />
      </Placement>

      rc = (bmclear +       12.4)
      xc = rc           * cos( 30.0*degrad*(iblade-1) + 90*degrad)
      yc = rc           * sin( 30.0*degrad*(iblade-1) + 90*degrad)

      <Placement block="FSIC" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-1)" />

      </Placement>

<!--
      rc = (bmclear       + 12.4*2)
      xc = rc                  * cos( 30.0*degrad*(iblade-1) + 90*degrad)
      yc = rc                  * sin( 30.0*degrad*(iblade-1) + 90*degrad)

      <Placement block="FSIC" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-1)" />

      </Placement>

      rc = (bmclear +       12.4*3 )
      xc = rc                          * cos( 30.0*degrad*(iblade-1) + 90*degrad)
      yc = rc                          * sin( 30.0*degrad*(iblade-1) + 90*degrad)

      <Placement block="FSIC" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-1)" />

      </Placement>
-->

      <!-- ##################################################################### Spoke 2 ### -->
      rc = (bmclear + 6.2 + 7.75)
      xc = (bmclear + 6.2 + 7.75) * cos( 30.0*degrad*(iblade-0.5) + 90*degrad)
      yc = (bmclear + 6.2 + 7.75) * sin( 30.0*degrad*(iblade-0.5) + 90*degrad)

      <Placement block="FSIC" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-0.5)" />

      </Placement>

<!--
      rc = (bmclear + 6.2 + 7.75 + 12.4)
      xc = (bmclear + 6.2 + 7.75 + 12.4) * cos( 30.0*degrad*(iblade-0.5) + 90*degrad)
      yc = (bmclear + 6.2 + 7.75 + 12.4) * sin( 30.0*degrad*(iblade-0.5) + 90*degrad)

      <Placement block="FSIC" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-0.5)" />

      </Placement>

      rc = (bmclear + 6.2 + 7.75 + 12.4 + 12.4)
      xc = (bmclear + 6.2 + 7.75 + 12.4 + 12.4) * cos( 30.0*degrad*(iblade-0.5) + 90*degrad)
      yc = (bmclear + 6.2 + 7.75 + 12.4 + 12.4) * sin( 30.0*degrad*(iblade-0.5) + 90*degrad)

      <Placement block="FSIC" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-0.5)" />

      </Placement>
-->
      <!-- #################################################################### Spoke 3 ### -->
<!--
      rc = (bmclear + 12.4*2 )
      xc = (bmclear + 12.4*2 ) * cos( 30.0*degrad*(iblade-0.25) + 90*degrad)
      yc = (bmclear + 12.4*2 ) * sin( 30.0*degrad*(iblade-0.25) + 90*degrad)

      <Placement block="FSIC" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-0.25)" />

      </Placement>
      rc = (bmclear + 12.4*3 )
      xc = (bmclear + 12.4*3 ) * cos( 30.0*degrad*(iblade-0.25) + 90*degrad)
      yc = (bmclear + 12.4*3 ) * sin( 30.0*degrad*(iblade-0.25) + 90*degrad)

      <Placement block="FSIC" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-0.25)" />

      </Placement>
-->
      <!-- ##################################################################### Spoke 4 ### -->
<!--
      rc = (bmclear + 12.4*2 )
      xc = (bmclear + 12.4*2 ) * cos( 30.0*degrad*(iblade-0.75) + 90*degrad)
      yc = (bmclear + 12.4*2 ) * sin( 30.0*degrad*(iblade-0.75) + 90*degrad)

      <Placement block="FSIC" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-0.75)" />

      </Placement>
      rc = (bmclear + 12.4*3 )
      xc = (bmclear + 12.4*3 ) * cos( 30.0*degrad*(iblade-0.75) + 90*degrad)
      yc = (bmclear + 12.4*3 ) * sin( 30.0*degrad*(iblade-0.75) + 90*degrad)

      <Placement block="FSIC" 	       dx="6.4/2" dy="12.4/2" dz="0.03"
		 x    = "xc"
		 y    = "yc" >
	<Rotation alphay="15.0" />
	<Rotation alphaz="30.0*(iblade-0.75)" />

      </Placement>
    -->     

    </Do></If>
    <If expr="MAIN_layout.eq.2"><Do var="iblade" from="1" to="15">
      
      rc = bmclear + 6.2;
      xc = rc     * cos( (360/15)*degrad*(iblade-1) + 90*degrad)
      yc = rc     * sin( (360/15)*degrad*(iblade-1) + 90*degrad)

      <Placement block="FSIC" dx="6.4/2" dy="12.4/2" dz="0.03" x="xc" y="yc" >
	<Rotation alphax="-15.0" />
	<Rotation alphay="15.0" />
	<Rotation alphaz="(360.0/15)*(iblade-1)" />
      </Placement>

    </Do></If>

  </Volume>

  <Volume name="FSIA" comment="Silicon sensor">

    <Material name="silicon"/>
    <Material name="silicon" isvol="1" /> <!-- will copy the material into the volume, rather than reference it -->
    <Attribute for="FSIA" seen="1" colo="419" serial="station" />
    <!-- We set the shape as a box with zero dimensions.  This allows us to
    specify the dimensions when we place the box -->
    <Shape type="box" dx="0" dy="0" dz="0" />

    <Instrument block="FSIA"  >
      <!-- Local coordinates 0.1 micron resolution -->
      <Hit meas="z"  opts="S" bins="0.00001"  />
      <Hit meas="y"  opts="S" bins="0.00001"  />
      <Hit meas="x"  opts="S" bins="0.00001"  />
      <!-- Global coordinates 0.1 micron resolution-->
      <Hit meas="zz" opts="S" bins="0.00001"  />
      <Hit meas="yy" opts="S" bins="0.00001"  />
      <Hit meas="xx" opts="S" bins="0.00001"  />
      <!-- Time of flight, energy lost, direction cosines, total momentum -->    
      <Hit meas="ptot"  nbits="16" min="0" max="100"  />
      <Hit meas="cx"    nbits="16"  />
      <Hit meas="cy"    nbits="16"  />
      <Hit meas="cz"    nbits="16"  />
      <Hit meas="tof"   nbits="16"  />
      <Hit meas="eloss" nbits="16"  />
    </Instrument>
    
  </Volume>
  <Volume name="FSIB" comment="Silicon sensor">

    <Material name="silicon"/>
    <Material name="silicon" isvol="1" /> <!-- will copy the material into the volume, rather than reference it -->
    <Attribute for="FSIB" seen="1" colo="419" serial="station" />
    <!-- We set the shape as a box with zero dimensions.  This allows us to
    specify the dimensions when we place the box -->
    <Shape type="box" dx="0" dy="0" dz="0" />

    <Instrument block="FSIB"  >
      <!-- Local coordinates 0.1 micron resolution -->
      <Hit meas="z"  opts="S" bins="0.00001"  />
      <Hit meas="y"  opts="S" bins="0.00001"  />
      <Hit meas="x"  opts="S" bins="0.00001"  />
      <!-- Global coordinates 0.1 micron resolution-->
      <Hit meas="zz" opts="S" bins="0.00001"  />
      <Hit meas="yy" opts="S" bins="0.00001"  />
      <Hit meas="xx" opts="S" bins="0.00001"  />
      <!-- Time of flight, energy lost, direction cosines, total momentum -->    
      <Hit meas="ptot"  nbits="16" min="0" max="100"  />
      <Hit meas="cx"    nbits="16"  />
      <Hit meas="cy"    nbits="16"  />
      <Hit meas="cz"    nbits="16"  />
      <Hit meas="tof"   nbits="16"  />
      <Hit meas="eloss" nbits="16"  />
    </Instrument>
    
  </Volume>
  <Volume name="FSIC" comment="Silicon sensor">

    <Material name="silicon"/>
    <Material name="silicon" isvol="1" /> <!-- will copy the material into the volume, rather than reference it -->
    <Attribute for="FSIC" seen="1" colo="419" serial="station" />
    <!-- We set the shape as a box with zero dimensions.  This allows us to
    specify the dimensions when we place the box -->
    <Shape type="box" dx="0" dy="0" dz="0" />

    <Instrument block="FSIC"  >
      <!-- Local coordinates 0.1 micron resolution -->
      <Hit meas="z"  opts="S" bins="0.00001"  />
      <Hit meas="y"  opts="S" bins="0.00001"  />
      <Hit meas="x"  opts="S" bins="0.00001"  />
      <!-- Global coordinates 0.1 micron resolution-->
      <Hit meas="zz" opts="S" bins="0.00001"  />
      <Hit meas="yy" opts="S" bins="0.00001"  />
      <Hit meas="xx" opts="S" bins="0.00001"  />
      <!-- Time of flight, energy lost, direction cosines, total momentum -->    
      <Hit meas="ptot"  nbits="16" min="0" max="100"  />
      <Hit meas="cx"    nbits="16"  />
      <Hit meas="cy"    nbits="16"  />
      <Hit meas="cz"    nbits="16"  />
      <Hit meas="tof"   nbits="16"  />
      <Hit meas="eloss" nbits="16"  />
    </Instrument>
    
  </Volume>

</Module>
<!--  ================================================================================================================ -->
</Document>
